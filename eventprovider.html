<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Providers - My Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="stylemobile.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ========== VARIABEL CSS ========== */
        :root {
            --primary-gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --success-gradient: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            --warning-gradient: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
            --info-gradient: linear-gradient(135deg, #4895ef 0%, #3f37c9 100%);
            --event-card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* ========== LAYOUT UTAMA ========== */
        .main-content {
            padding: var(--space-lg);
            background-color: var(--bg-secondary);
            min-height: 100vh;
        }

        .header {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: var(--text-2xl);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .header h1 i {
            color: var(--primary);
        }

        /* ========== STATS OVERVIEW ========== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            gap: var(--space-md);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-title {
            font-size: var(--text-md);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: var(--font-bold);
            color: var(--text-primary);
            margin: 0;
            line-height: 1.2;
        }

        .stat-content p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin: var(--space-xs) 0 0;
        }

        /* ========== QUICK ACTIONS ========== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .quick-action-btn {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .quick-action-btn:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .quick-action-btn i {
            font-size: 2rem;
            color: var(--primary);
        }

        .quick-action-btn span {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-primary);
        }

        /* ========== FILTER SECTION ========== */
        .filter-panel {
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-color);
        }

        .filter-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .filter-reset {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-sm) var(--space-md);
            font-size: var(--text-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .filter-reset:hover {
            background: var(--hover-color);
            color: var(--text-primary);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .filter-label {
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select, .filter-input {
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: var(--text-sm);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            height: 42px;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .advanced-filter {
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .advanced-filter.show {
            display: block;
        }

        /* ========== EVENTS GRID ========== */
        .events-section {
            margin-bottom: var(--space-xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: var(--space-xs);
            background: var(--bg-secondary);
            padding: var(--space-xs);
            border-radius: var(--radius-md);
        }

        .view-toggle-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .view-toggle-btn.active, .view-toggle-btn:hover {
            background: var(--card-bg);
            color: var(--primary);
            box-shadow: var(--shadow-xs);
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-lg);
        }

        .event-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
            position: relative;
        }

        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--event-card-shadow);
        }

        .event-image {
            height: 180px;
            overflow: hidden;
            position: relative;
        }

        .event-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .event-card:hover .event-image img {
            transform: scale(1.05);
        }

        .event-badge {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
        }

        .badge-active {
            background: var(--success-light);
            color: var(--success);
        }

        .badge-upcoming {
            background: var(--info-light);
            color: var(--info);
        }

        .badge-inactive {
            background: var(--warning-light);
            color: var(--warning);
        }

        .event-content {
            padding: var(--space-lg);
        }

        .event-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0 0 var(--space-xs);
            line-height: 1.3;
        }

        .event-description {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin: 0 0 var(--space-md);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .event-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .event-participants {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
        }

        .event-participants i {
            color: var(--primary);
        }

        .event-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }

        .event-detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .detail-label {
            font-size: var(--text-xs);
            color: var(--text-secondary);
        }

        .detail-value {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-primary);
        }

        .event-actions {
            display: flex;
            gap: var(--space-xs);
        }

        .btn {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            border: 1px solid transparent;
        }

        .btn-sm {
            padding: var(--space-xs) var(--space-sm);
            font-size: var(--text-xs);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .btn-outline:hover {
            background: var(--hover-color);
            color: var(--text-primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: var(--success-dark);
            border-color: var(--success-dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-danger:hover {
            background: var(--danger-dark);
            border-color: var(--danger-dark);
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border-color);
            margin: var(--space-lg) 0;
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 300px;
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-md);
        }

        .empty-state h3 {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .empty-state p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-lg);
        }

        /* ========== MODAL STYLES ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast);
        }

        .modal-close:hover {
            background-color: var(--hover-color);
            color: var(--text-primary);
        }

        .modal-body {
            padding: var(--space-lg);
        }

        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-primary);
        }

        .form-label.required::after {
            content: '*';
            color: var(--danger);
            margin-left: 4px;
        }

        .form-input, .form-select, .form-textarea {
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: var(--text-sm);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-top: var(--space-xs);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .checkbox-item label {
            font-size: var(--text-sm);
            color: var(--text-primary);
        }

        .form-hint {
            font-size: var(--text-xs);
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .image-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            cursor: pointer;
            transition: border-color var(--transition-fast);
        }

        .image-upload:hover {
            border-color: var(--primary);
        }

        .image-upload i {
            font-size: 2rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-sm);
        }

        .image-upload p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin: 0;
        }

        .image-upload input[type="file"] {
            display: none;
        }

        .image-preview {
            margin-top: var(--space-md);
            display: none;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: var(--radius-md);
        }

        /* ========== ANIMATIONS ========== */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== RESPONSIVE ADJUSTMENTS ========== */
        @media (max-width: 1024px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .events-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: var(--space-md);
            }
            
            .header {
                padding: var(--space-md);
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-md);
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .section-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .events-grid {
                grid-template-columns: 1fr;
            }
            
            .modal {
                width: 95%;
                margin: var(--space-md);
            }
        }

        @media (max-width: 640px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .filter-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .event-details {
                grid-template-columns: 1fr;
            }
            
            .event-actions {
                flex-direction: column;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .modal-footer .btn {
                width: 100%;
            }
        }

        /* ========== REFRESH ANIMATION ========== */
        .refreshing {
            position: relative;
            pointer-events: none;
        }

        .refreshing::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: var(--radius-lg);
        }

        .refreshing::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 3px solid var(--primary-light);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            z-index: 11;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
         .image-preview {
            margin-top: 10px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: #4CAF50;
        }

        .notification.error {
            background-color: #F44336;
        }

        .notification.info {
            background-color: #2196F3;
        }

        .notification.warning {
            background-color: #FF9800;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            margin-left: 15px;
        }
        /* ========== FILTER ACTIONS ========== */
.filter-actions {
    display: flex;
    align-items: center;
}

.filter-buttons {
    display: flex;
    gap: var(--space-sm);
    flex-wrap: wrap;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .filter-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
    }
    
    .filter-actions {
        width: 100%;
    }
    
    .filter-buttons {
        width: 100%;
    }
    
    .filter-buttons .filter-reset {
        flex: 1;
        min-width: 140px;
    }
}

@media (max-width: 480px) {
    .filter-buttons {
        flex-direction: column;
    }
    
    .filter-buttons .filter-reset {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <div id="sidebar-container"></div>
   
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div id="notificationContainer"></div>
            <button class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <h1><i class="fas fa-trophy"></i> Event Providers</h1>
            
            <div class="header-actions">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search events..." id="eventsSearch">
                </div>
                
                <div class="user-profile">
                    <img class="profile-img" src="https://iili.io/Fpiva7S.png" alt="Profile">
                    <div class="user-info">
                        <h4>My Profile</h4>
                        <p>Event Administrator</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="stats-container fade-in">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Total Events</span>
                    <div class="stat-icon" style="background: var(--primary-light); color: var(--primary);">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                </div>
                <div class="stat-content">
                    <h3 id="totalEvents">0</h3>
                    <p>Total Events</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Active Events</span>
                    <div class="stat-icon" style="background: var(--success-light); color: var(--success);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-content">
                    <h3 id="activeEvents">0</h3>
                    <p>Currently running</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Upcoming Events</span>
                    <div class="stat-icon" style="background: var(--info-light); color: var(--info);">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                <div class="stat-content">
                    <h3 id="upcomingEvents">0</h3>
                    <p>Scheduled events</p>
                </div>
            </div>
        </div>
    
        <!-- Filter Panel -->
        <div class="filter-panel fade-in">
<!-- Ganti bagian filter header dengan kode berikut -->
<div class="filter-header">
    <h3 class="filter-title">Filter Releases</h3>
    <div class="filter-actions">
        <div class="filter-buttons">
            <button class="filter-reset" id="resetFilters">
                <i class="fas fa-sync-alt"></i> Reset Filters
            </button>
            <button class="filter-reset" id="toggleAdvancedFilters">
                <i class="fas fa-sliders-h"></i> Advanced Filters
            </button>
        </div>
    </div>
</div>
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="upcoming">Upcoming</option>
                        <option value="completed">Completed</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Category</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="Tournament">Tournament</option>
                        <option value="Promotion">Promotion</option>
                        <option value="Competition">Competition</option>
                        <option value="Giveaway">Giveaway</option>
                        <option value="Special">Special Event</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Provider</label>
                    <select class="filter-select" id="providerFilter">
                        <option value="">All Providers</option>
                        <option value="PG SOFT">PG SOFT</option>
                        <option value="PRAGMATIC PLAY">PRAGMATIC PLAY</option>
                        <option value="JOKER">JOKER</option>
                        <option value="ADVANT PLAY">ADVANT PLAY</option>
                        <option value="MICROGAMING">MICROGAMING</option>
                        <option value="PS STAR">PS STAR</option>
                        <option value="JILI">JILI</option>
                        <option value="HABANERO">HABANERO</option>
                        <option value="CQ9">CQ9</option>
                        <option value="JDB">JDB</option>
                        <option value="GG SOFT">GG SOFT</option>
                        <option value="KING MAKER">KING MAKER</option>
                        <option value="FA CHAI">FA CHAI</option>
                        <option value="FAST SPIN">FAST SPIN</option>
                        <option value="SPADE GAMING">SPADE GAMING</option>
                        <option value="NETENT">NETENT</option>
                        <option value="NOLIMIT CITY">NOLIMIT CITY</option>
                        <option value="RED TIGER">RED TIGER</option>
                        <option value="OCTOPLAY">OCTOPLAY</option>
                        <option value="HACKSAW GAMING">HACKSAW GAMING</option>
                        <option value="FAT PANDA">FAT PANDA</option>
                        <option value="RTG SLOT">RTG SLOT</option>
                        <option value="SIMPLEPLAY">SIMPLEPLAY</option>
                        <option value="SEXY GAME">SEXY GAME</option>
                        <option value="ION CASINO">ION CASINO</option>
                        <option value="SBOBET">SBOBET</option>
                        <option value="EVOLUTION">EVOLUTION</option>
                        <option value="SA GAMING">SA GAMING</option>
                        <option value="UG SPORT">UG SPORT</option>
                        <option value="SABA SPORT">SABA SPORT</option>
                        <option value="VELIPLAY">VELIPLAY</option>
                    </select>
                </div>
            </div>
            
            <!-- Advanced Filters -->
            <div class="advanced-filter" id="advancedFilters">
                <div class="filter-header">
                    <h3 class="filter-title">Advanced Filters</h3>
                </div>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">Event Date</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="date" class="filter-input" id="dateFrom" placeholder="From">
                            <input type="date" class="filter-input" id="dateTo" placeholder="To">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="sortBy">
                        <option value="title">Name</option>
                        <option value="startDate">Start Date</option>
                        <option value="participants">Participants</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Order</label>
                    <select class="filter-select" id="sortOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Events Section -->
    <div class="events-section fade-in">
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-list"></i> Event Library</h2>
            <div class="section-actions">
                <div class="view-toggle">
                </div>
                <button class="btn btn-outline" id="refreshEvents">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-primary" id="addEventBtn">
                    <i class="fas fa-plus"></i> Add Event
                </button>
            </div>
        </div>
        
        <!-- Events Grid -->
        <div class="events-grid" id="eventsGrid">
            <!-- Events will be loaded dynamically -->
        </div>
        
        <div id="noEvents" class="empty-state" style="display: none;">
            <i class="fas fa-calendar-alt"></i>
            <h3>No Events Found</h3>
            <p>There are no events matching your criteria. Try adjusting your filters or add a new event.</p>
            <button class="btn btn-primary" id="addFirstEvent">
                <i class="fas fa-plus"></i> Add Your First Event
            </button>
        </div>
    </div>
    
    <!-- Add Event Modal -->
    <div class="modal-overlay" id="addEventModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-plus"></i> Add New Event</h3>
                <button class="modal-close" id="closeAddModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="eventForm">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label required">Event Title</label>
                            <input type="text" class="form-input" id="eventTitle" required placeholder="Enter event title">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Category</label>
                            <select class="form-select" id="eventCategory" required>
                                <option value="">Select Category</option>
                                <option value="Tournament">Tournament</option>
                                <option value="Promotion">Promotion</option>
                                <option value="Competition">Competition</option>
                                <option value="Giveaway">Giveaway</option>
                                <option value="Special">Special Event</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Provider</label>
                            <select class="form-select" id="eventProvider" required>
                                <option value="">Select Provider</option>
                                <option value="">All Providers</option>
                        <option value="PG SOFT">PG SOFT</option>
                        <option value="PRAGMATIC PLAY">PRAGMATIC PLAY</option>
                        <option value="JOKER">JOKER</option>
                        <option value="ADVANT PLAY">ADVANT PLAY</option>
                        <option value="MICROGAMING">MICROGAMING</option>
                        <option value="PS STAR">PS STAR</option>
                        <option value="JILI">JILI</option>
                        <option value="HABANERO">HABANERO</option>
                        <option value="CQ9">CQ9</option>
                        <option value="JDB">JDB</option>
                        <option value="GG SOFT">GG SOFT</option>
                        <option value="KING MAKER">KING MAKER</option>
                        <option value="FA CHAI">FA CHAI</option>
                        <option value="FAST SPIN">FAST SPIN</option>
                        <option value="SPADE GAMING">SPADE GAMING</option>
                        <option value="NETENT">NETENT</option>
                        <option value="NOLIMIT CITY">NOLIMIT CITY</option>
                        <option value="RED TIGER">RED TIGER</option>
                        <option value="OCTOPLAY">OCTOPLAY</option>
                        <option value="HACKSAW GAMING">HACKSAW GAMING</option>
                        <option value="FAT PANDA">FAT PANDA</option>
                        <option value="RTG SLOT">RTG SLOT</option>
                        <option value="SIMPLEPLAY">SIMPLEPLAY</option>
                        <option value="SEXY GAME">SEXY GAME</option>
                        <option value="ION CASINO">ION CASINO</option>
                        <option value="SBOBET">SBOBET</option>
                        <option value="EVOLUTION">EVOLUTION</option>
                        <option value="SA GAMING">SA GAMING</option>
                        <option value="UG SPORT">UG SPORT</option>
                        <option value="SABA SPORT">SABA SPORT</option>
                        <option value="VELIPLAY">VELIPLAY</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="eventStatus">
                                <option value="active">Active</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="completed">Completed</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Start Date</label>
                            <input type="datetime-local" class="form-input" id="eventStartDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">End Date</label>
                            <input type="datetime-local" class="form-input" id="eventEndDate" required>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="eventDescription" placeholder="Enter event description"></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                        <label class="form-label">Event Image</label>
                        <div class="image-upload" id="imageUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload or drag and drop</p>
                            <p class="form-hint">JPG, PNG, GIF, WebP, SVG (semua format gambar didukung)</p>
                            <input type="file" id="eventImage" accept="image/*">
                        </div>
                        <div class="image-preview" id="imagePreview">
                            <img src="" alt="Preview">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="cancelAddEvent">Cancel</button>
            <button class="btn btn-primary" id="saveEvent">Save Event</button>
        </div>
    </div>
</div>
    
    <!-- Edit Event Modal -->
    <div class="modal-overlay" id="editEventModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Event</h3>
                <button class="modal-close" id="closeEditModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Edit form will be loaded dynamically -->
                <div id="editFormContainer"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelEditEvent">Cancel</button>
                <button class="btn btn-primary" id="updateEvent">Update Event</button>
                <button class="btn btn-danger" id="deleteEvent">Delete Event</button>
            </div>
        </div>
    </div>
    
    <!-- Event Details Modal -->
    <div class="modal-overlay" id="eventDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-info-circle"></i> Event Details</h3>
                <button class="modal-close" id="closeDetailsModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Event details will be loaded dynamically -->
                <div id="eventDetailsContainer"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeDetails">Close</button>
                <button class="btn btn-primary" id="editFromDetails">Edit Event</button>
            </div>
        </div>
    </div>
    
    <script src="sidebar-loader.js"></script>
    <script src="user-profile.js"></script>
    <script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDUZka4FZyLi_cv6X_5D4zeRsfkpqOlBpY",
    authDomain: "dashboard-css.firebaseapp.com",
    databaseURL: "https://dashboard-css-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "dashboard-css",
    storageBucket: "dashboard-css.appspot.com",
    messagingSenderId: "771131792881",
    appId: "1:771131792881:web:ad634424225bd7de847850",
    measurementId: "G-3CYBC5B101"
};

// Initialize Firebase (HAPUS STORAGE)
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Variabel global
let currentUser = null;
let events = [];
let filteredEvents = [];
let unsubscribeEvents = null;
let isEditing = false;
let currentEditId = null;
let currentImage = null;

// ========== FIXED EVENTS LISTENER ==========
function setupEventsListener() {
    if (unsubscribeEvents) {
        unsubscribeEvents(); // Remove old listener if exists
    }
    
    try {
        console.log("Setting up events listener...");
        
        unsubscribeEvents = db.collection('events')
            .onSnapshot(snapshot => {
                events = [];
                snapshot.forEach(doc => {
                    try {
                        const event = doc.data();
                        event.id = doc.id;
                        events.push(event);
                        console.log("Event loaded:", event.title);
                    } catch (e) {
                        console.error("Error processing document:", e);
                    }
                });
                
                console.log(`Found ${events.length} events`);
                filteredEvents = [...events];
                renderEvents();
                updateEventStats();
                
            }, error => {
                console.error("Error fetching events:", error);
                showNotification('Error loading events. Please check console for details.', 'error');
            });
        
    } catch (error) {
        console.error("Error setting up listener:", error);
        showNotification('Error setting up data connection.', 'error');
    }
}

// ========== FUNGSI NOTIFIKASI ==========
function showNotification(message, type = 'info') {
    // Hapus notifikasi sebelumnya jika ada
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => {
        notification.remove();
    });
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
        <button class="notification-close">&times;</button>
    `;
    
    document.body.appendChild(notification);
    
    // Show the notification
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Add event listener to close button
    const closeBtn = notification.querySelector('.notification-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', () => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        });
    }
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
    }, 5000);
}

// ========== FIREBASE AUTHENTICATION ==========
function checkAuthState() {
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            console.log("User is signed in:", user.uid);
            setupEventsListener();
            setupEventListeners();
            loadEvents(); // Apply initial filters
        } else {
            console.log("User is signed out");
            window.location.href = "login.html";
        }
    }, (error) => {
        console.error("Auth state error:", error);
        showNotification('Authentication error. Please try again.', 'error');
    });
}

// Add a new event to Firestore
async function addEvent(eventData) {
    try {
        const newEvent = {
            ...eventData,
            userId: currentUser.uid,
            projectcss: "pengshui",
            dateCreated: new Date(),
            dateUpdated: new Date(),
            startDate: eventData.startDate,
            endDate: eventData.endDate
        };
        
        await db.collection('events').add(newEvent);
        showNotification(`"${eventData.title}" has been added successfully!`, 'success');
        return true;
    } catch (error) {
        console.error("Error adding event:", error);
        showNotification('Error adding event. Please try again.', 'error');
        throw error;
    }
}

// Update an existing event in Firestore
async function updateEvent(id, eventData) {
    try {
        await db.collection('events').doc(id).update({
            ...eventData,
            dateUpdated: new Date()
        });
        
        showNotification(`"${eventData.title}" has been updated successfully!`, 'success');
        return true;
    } catch (error) {
        console.error("Error updating event:", error);
        showNotification('Error updating event. Please try again.', 'error');
        throw error;
    }
}

// Delete an event from Firestore
async function deleteEvent(id) {
    const event = events.find(e => e.id === id);
    if (!event) return;
    
    if (confirm(`Are you sure you want to delete "${event.title}"?`)) {
        try {
            await db.collection('events').doc(id).delete();
            showNotification('Event deleted successfully!', 'success');
        } catch (error) {
            console.error("Error deleting event:", error);
            showNotification('Error deleting event. Please try again.', 'error');
        }
    }
}

// ========== EVENT MANAGEMENT FUNCTIONS ==========
// Format date for display
function formatDisplayDate(dateString) {
    if (!dateString) return 'N/A';
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString('en-US', options);
}

// Format date and time for display
function formatDisplayDateTime(dateString) {
    if (!dateString) return 'N/A';
    const options = { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    return new Date(dateString).toLocaleDateString('en-US', options);
}

// Update event statistics
function updateEventStats() {
    const totalCount = events.length;
    const upcomingCount = events.filter(event => 
        new Date(event.startDate) > new Date()
    ).length;
    const ongoingCount = events.filter(event => 
        new Date(event.startDate) <= new Date() && new Date(event.endDate) >= new Date()
    ).length;
    
    document.getElementById('totalEvents').textContent = totalCount;
    document.getElementById('upcomingEvents').textContent = upcomingCount;
    document.getElementById('activeEvents').textContent = ongoingCount;
}

// Handle image upload and conversion to base64
function handleImageUpload(event, callback) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('File selected:', file.name, file.type, file.size);
    
    // Validasi yang lebih sederhana dan toleran
    const validImageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'];
    const fileExtension = file.name.split('.').pop().toLowerCase();
    const validExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'];
    
    if (!validImageTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
        showNotification('Please select a valid image file (JPG, PNG, GIF, WebP, or SVG).', 'error');
        return;
    }
    
    // Batasi ukuran file (max 2MB untuk menghindari masalah Firestore)
    if (file.size > 2 * 1024 * 1024) {
        showNotification('Image size should be less than 2MB.', 'error');
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        const imageUrl = e.target.result;
        console.log('Image loaded successfully');
        callback(imageUrl);
    };
    
    reader.onerror = function() {
        console.error('Error reading file:', reader.error);
        showNotification('Error reading image file. Please try another image.', 'error');
    };
    
    reader.readAsDataURL(file);
}

// Setup image upload listeners
function setupImageUploadListeners() {
    // Untuk modal Add Event
    const imageUploadArea = document.getElementById('imageUpload');
    const imageInput = document.getElementById('eventImage');
    const imagePreview = document.getElementById('imagePreview');
    
    if (imageUploadArea && imageInput) {
        // Click pada area upload
        imageUploadArea.addEventListener('click', () => {
            imageInput.click();
        });
        
        // Drag and drop
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.style.borderColor = 'var(--primary)';
            imageUploadArea.style.backgroundColor = 'var(--primary-light)';
        });
        
        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.style.borderColor = 'var(--border-color)';
            imageUploadArea.style.backgroundColor = 'transparent';
        });
        
        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.style.borderColor = 'var(--border-color)';
            imageUploadArea.style.backgroundColor = 'transparent';
            
            if (e.dataTransfer.files.length) {
                imageInput.files = e.dataTransfer.files;
                const event = new Event('change');
                imageInput.dispatchEvent(event);
            }
        });
        
        // Perubahan pada input file
        imageInput.addEventListener('change', (e) => {
            handleImageUpload(e, (imageUrl) => {
                if (imagePreview) {
                    imagePreview.querySelector('img').src = imageUrl;
                    imagePreview.style.display = 'block';
                    currentImage = imageUrl;
                }
            });
        });
    }
    
    // Untuk modal Edit Event (setup dinamis setelah modal terbuka)
    setTimeout(() => {
        const editImageUpload = document.getElementById('editImageUpload');
        const editImageInput = document.getElementById('editEventImage');
        const editImagePreview = document.getElementById('editImagePreview');
        
        if (editImageUpload && editImageInput) {
            editImageUpload.addEventListener('click', () => {
                editImageInput.click();
            });
            
            editImageInput.addEventListener('change', (e) => {
                handleImageUpload(e, (imageUrl) => {
                    if (editImagePreview) {
                        editImagePreview.querySelector('img').src = imageUrl;
                        editImagePreview.style.display = 'block';
                        currentImage = imageUrl;
                    }
                });
            });
        }
    }, 100);
}

// Create event card element
function createEventCard(event) {
    const card = document.createElement('div');
    card.className = 'event-card';
    card.dataset.id = event.id;
    
    // Determine badge based on status
    let badge = '';
    const now = new Date();
    const startDate = new Date(event.startDate);
    const endDate = new Date(event.endDate);
    
    if (startDate > now) {
        badge = `<div class="event-badge badge-upcoming">Upcoming</div>`;
    } else if (startDate <= now && endDate >= now) {
        badge = `<div class="event-badge badge-active">Active</div>`;
    } else if (endDate < now) {
        badge = `<div class="event-badge badge-inactive">Completed</div>`;
    }
    
    card.innerHTML = `
        <div class="event-image">
            <img src="${event.image || 'https://via.placeholder.com/300x180?text=Event+Image'}" alt="${event.title}" onerror="this.src='https://via.placeholder.com/300x180?text=Event+Image'">
            ${badge}
        </div>
        <div class="event-content">
            <h3 class="event-title">${event.title}</h3>
            <p class="event-description">${event.description || 'No description available.'}</p>
            
            <div class="event-details">
                <div class="event-detail-item">
                    <span class="detail-label">Category</span>
                    <span class="detail-value">${event.category}</span>
                </div>
                <div class="event-detail-item">
                    <span class="detail-label">Provider</span>
                    <span class="detail-value">${event.provider || 'N/A'}</span>
                </div>
                <div class="event-detail-item">
                    <span class="detail-label">Start Date</span>
                    <span class="detail-value">${formatDisplayDateTime(event.startDate)}</span>
                </div>
                <div class="event-detail-item">
                    <span class="detail-label">End Date</span>
                    <span class="detail-value">${formatDisplayDateTime(event.endDate)}</span>
                </div>
                <div class="event-detail-item">
                    <span class="detail-label">Status</span>
                    <span class="detail-value">${event.status || 'active'}</span>
                </div>
            </div>
            
            <div class="event-actions">
                <button class="btn btn-outline btn-sm edit-event" data-id="${event.id}">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-primary btn-sm view-event" data-id="${event.id}">
                    <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-danger btn-sm delete-event" data-id="${event.id}">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    `;
    
    // Add event listeners to buttons
    const editBtn = card.querySelector('.edit-event');
    const viewBtn = card.querySelector('.view-event');
    const deleteBtn = card.querySelector('.delete-event');
    
    if (editBtn) editBtn.addEventListener('click', () => openEditEventModal(event.id));
    if (viewBtn) viewBtn.addEventListener('click', () => viewEvent(event.id));
    if (deleteBtn) deleteBtn.addEventListener('click', () => deleteEvent(event.id));
    
    return card;
}

// Load events into the grid
function renderEvents() {
    const eventsGrid = document.getElementById('eventsGrid');
    const noEvents = document.getElementById('noEvents');
    
    if (!eventsGrid) return;
    
    if (filteredEvents.length === 0) {
        eventsGrid.style.display = 'none';
        if (noEvents) noEvents.style.display = 'flex';
        return;
    }
    
    eventsGrid.style.display = 'grid';
    if (noEvents) noEvents.style.display = 'none';
    
    // Clear the grid
    eventsGrid.innerHTML = '';
    
    // Render each event
    filteredEvents.forEach(event => {
        const eventCard = createEventCard(event);
        eventsGrid.appendChild(eventCard);
    });
}

// Load events with filters applied
function loadEvents() {
    const statusFilter = document.getElementById('statusFilter')?.value || '';
    const categoryFilter = document.getElementById('categoryFilter')?.value || '';
    const providerFilter = document.getElementById('providerFilter')?.value || '';
    const dateFrom = document.getElementById('dateFrom')?.value || '';
    const dateTo = document.getElementById('dateTo')?.value || '';
    const sortBy = document.getElementById('sortBy')?.value || 'title';
    const sortOrder = document.getElementById('sortOrder')?.value || 'asc';
    const searchValue = document.getElementById('eventsSearch')?.value.toLowerCase() || '';
    
    let result = [...events];
    
    // Apply filters
    if (statusFilter) {
        result = result.filter(event => event.status === statusFilter);
    }
    
    if (categoryFilter) {
        result = result.filter(event => event.category === categoryFilter);
    }
    
    if (providerFilter) {
        result = result.filter(event => event.provider === providerFilter);
    }
    
    if (dateFrom) {
        result = result.filter(event => new Date(event.startDate) >= new Date(dateFrom));
    }
    
    if (dateTo) {
        const toDate = new Date(dateTo);
        toDate.setHours(23, 59, 59, 999); // Set to end of day
        result = result.filter(event => new Date(event.startDate) <= toDate);
    }
    
    if (searchValue) {
        result = result.filter(event => 
            event.title.toLowerCase().includes(searchValue) || 
            (event.description && event.description.toLowerCase().includes(searchValue)) ||
            (event.category && event.category.toLowerCase().includes(searchValue)) ||
            (event.provider && event.provider.toLowerCase().includes(searchValue))
        );
    }
    
    // Apply sorting
    result.sort((a, b) => {
        // Prioritaskan event upcoming
        const now = new Date();
        const aIsUpcoming = new Date(a.startDate) > now;
        const bIsUpcoming = new Date(b.startDate) > now;
        
        if (aIsUpcoming && !bIsUpcoming) return -1;
        if (!aIsUpcoming && bIsUpcoming) return 1;
        
        // Jika kedua event upcoming, urutkan berdasarkan tanggal mulai (yang akan datang lebih dulu)
        if (aIsUpcoming && bIsUpcoming) {
            return new Date(a.startDate) - new Date(b.startDate);
        }
        
        // Untuk event non-upcoming, urutkan berdasarkan tanggal mulai (yang terbaru pertama)
        if (!aIsUpcoming && !bIsUpcoming) {
            return new Date(b.startDate) - new Date(a.startDate);
        }
        
        // Default sorting berdasarkan parameter yang dipilih
        let valueA, valueB;
        
        switch (sortBy) {
            case 'title':
                valueA = a.title.toLowerCase();
                valueB = b.title.toLowerCase();
                break;
            case 'startDate':
                valueA = new Date(a.startDate);
                valueB = new Date(b.startDate);
                break;
            case 'participants':
                valueA = a.participants || 0;
                valueB = b.participants || 0;
                break;
            default:
                valueA = a.title.toLowerCase();
                valueB = b.title.toLowerCase();
        }
        
        if (sortOrder === 'asc') {
            return valueA > valueB ? 1 : -1;
        } else {
            return valueA < valueB ? 1 : -1;
        }
    });
    
    filteredEvents = result;
    renderEvents();
}

// Reset all filters
function resetFilters() {
    const statusFilter = document.getElementById('statusFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    const providerFilter = document.getElementById('providerFilter');
    const dateFrom = document.getElementById('dateFrom');
    const dateTo = document.getElementById('dateTo');
    const sortBy = document.getElementById('sortBy');
    const sortOrder = document.getElementById('sortOrder');
    const eventsSearch = document.getElementById('eventsSearch');
    
    if (statusFilter) statusFilter.value = '';
    if (categoryFilter) categoryFilter.value = '';
    if (providerFilter) providerFilter.value = '';
    if (dateFrom) dateFrom.value = '';
    if (dateTo) dateTo.value = '';
    if (sortBy) sortBy.value = 'title';
    if (sortOrder) sortOrder.value = 'asc';
    if (eventsSearch) eventsSearch.value = '';
    
    loadEvents();
}

// Toggle advanced filters
function toggleAdvancedFilters() {
    const advancedFilters = document.getElementById('advancedFilters');
    if (advancedFilters) {
        advancedFilters.classList.toggle('show');
    }
}

// ========== MODAL FUNCTIONS ==========
// Open add event modal
function openAddEventModal() {
    console.log('Opening add event modal');
    const modal = document.getElementById('addEventModal');
    if (modal) {
        modal.classList.add('active');
        
        // Reset form
        document.getElementById('eventForm').reset();
        document.getElementById('imagePreview').style.display = 'none';
        currentImage = null;
        
        // Set default dates
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const startDateInput = document.getElementById('eventStartDate');
        const endDateInput = document.getElementById('eventEndDate');
        
        if (startDateInput) {
            startDateInput.value = today.toISOString().slice(0, 16);
        }
        if (endDateInput) {
            endDateInput.value = tomorrow.toISOString().slice(0, 16);
        }
        
        // Setup image upload listeners setelah modal terbuka
        setTimeout(setupImageUploadListeners, 100);
    } else {
        console.error('Add event modal not found');
    }
}

// Close add event modal
function closeAddEventModal() {
    const modal = document.getElementById('addEventModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Open edit event modal
function openEditEventModal(eventId) {
    const event = events.find(e => e.id === eventId);
    if (!event) return;
    
    const modal = document.getElementById('editEventModal');
    if (!modal) return;
    
    // Set modal title
    modal.querySelector('.modal-title').innerHTML = `<i class="fas fa-edit"></i> Edit ${event.title}`;
    
    // Create form content
    const formContent = document.createElement('div');
    formContent.innerHTML = `
        <form id="editEventForm">
            <div class="form-grid">
                <div class="form-group full-width">
                    <label class="form-label required">Event Title</label>
                    <input type="text" class="form-input" id="editEventTitle" value="${event.title}" required placeholder="Enter event title">
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Category</label>
                    <select class="form-select" id="editEventCategory" required>
                        <option value="Tournament" ${event.category === 'Tournament' ? 'selected' : ''}>Tournament</option>
                        <option value="Promotion" ${event.category === 'Promotion' ? 'selected' : ''}>Promotion</option>
                        <option value="Competition" ${event.category === 'Competition' ? 'selected' : ''}>Competition</option>
                        <option value="Giveaway" ${event.category === 'Giveaway' ? 'selected' : ''}>Giveaway</option>
                        <option value="Special" ${event.category === 'Special' ? 'selected' : ''}>Special Event</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Provider</label>
                    <select class="form-select" id="editEventProvider" required>
                        <option value="">Select Provider</option>
                        <option value="PG SOFT" ${event.provider === 'PG SOFT' ? 'selected' : ''}>PG SOFT</option>
                        <option value="PRAGMATIC PLAY" ${event.provider === 'PRAGMATIC PLAY' ? 'selected' : ''}>PRAGMATIC PLAY</option>
                        <option value="JOKER" ${event.provider === 'JOKER' ? 'selected' : ''}>JOKER</option>
                        <option value="ADVANT PLAY" ${event.provider === 'ADVANT PLAY' ? 'selected' : ''}>ADVANT PLAY</option>
                        <option value="MICROGAMING" ${event.provider === 'MICROGAMING' ? 'selected' : ''}>MICROGAMING</option>
                        <option value="PS STAR" ${event.provider === 'PS STAR' ? 'selected' : ''}>PS STAR</option>
                        <option value="JILI" ${event.provider === 'JILI' ? 'selected' : ''}>JILI</option>
                        <option value="HABANERO" ${event.provider === 'HABANERO' ? 'selected' : ''}>HABANERO</option>
                        <option value="CQ9" ${event.provider === 'CQ9' ? 'selected' : ''}>CQ9</option>
                        <option value="JDB" ${event.provider === 'JDB' ? 'selected' : ''}>JDB</option>
                        <option value="GG SOFT" ${event.provider === 'GG SOFT' ? 'selected' : ''}>GG SOFT</option>
                        <option value="KING MAKER" ${event.provider === 'KING MAKER' ? 'selected' : ''}>KING MAKER</option>
                        <option value="FA CHAI" ${event.provider === 'FA CHAI' ? 'selected' : ''}>FA CHAI</option>
                        <option value="FAST SPIN" ${event.provider === 'FAST SPIN' ? 'selected' : ''}>FAST SPIN</option>
                        <option value="SPADE GAMING" ${event.provider === 'SPADE GAMING' ? 'selected' : ''}>SPADE GAMING</option>
                        <option value="NETENT" ${event.provider === 'NETENT' ? 'selected' : ''}>NETENT</option>
                        <option value="NOLIMIT CITY" ${event.provider === 'NOLIMIT CITY' ? 'selected' : ''}>NOLIMIT CITY</option>
                        <option value="RED TIGER" ${event.provider === 'RED TIGER' ? 'selected' : ''}>RED TIGER</option>
                        <option value="OCTOPLAY" ${event.provider === 'OCTOPLAY' ? 'selected' : ''}>OCTOPLAY</option>
                        <option value="HACKSAW GAMING" ${event.provider === 'HACKSAW GAMING' ? 'selected' : ''}>HACKSAW GAMING</option>
                        <option value="FAT PANDA" ${event.provider === 'FAT PANDA' ? 'selected' : ''}>FAT PANDA</option>
                        <option value="RTG SLOT" ${event.provider === 'RTG SLOT' ? 'selected' : ''}>RTG SLOT</option>
                        <option value="SIMPLEPLAY" ${event.provider === 'SIMPLEPLAY' ? 'selected' : ''}>SIMPLEPLAY</option>
                        <option value="SEXY GAME" ${event.provider === 'SEXY GAME' ? 'selected' : ''}>SEXY GAME</option>
                        <option value="ION CASINO" ${event.provider === 'ION CASINO' ? 'selected' : ''}>ION CASINO</option>
                        <option value="SBOBET" ${event.provider === 'SBOBET' ? 'selected' : ''}>SBOBET</option>
                        <option value="EVOLUTION" ${event.provider === 'EVOLUTION' ? 'selected' : ''}>EVOLUTION</option>
                        <option value="SA GAMING" ${event.provider === 'SA GAMING' ? 'selected' : ''}>SA GAMING</option>
                        <option value="UG SPORT" ${event.provider === 'UG SPORT' ? 'selected' : ''}>UG SPORT</option>
                        <option value="SABA SPORT" ${event.provider === 'SABA SPORT' ? 'selected' : ''}>SABA SPORT</option>
                        <option value="VELIPLAY" ${event.provider === 'VELIPLAY' ? 'selected' : ''}>VELIPLAY</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="editEventStatus">
                        <option value="active" ${event.status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="upcoming" ${event.status === 'upcoming' ? 'selected' : ''}>Upcoming</option>
                        <option value="completed" ${event.status === 'completed' ? 'selected' : ''}>Completed</option>
                        <option value="inactive" ${event.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">Start Date</label>
                    <input type="datetime-local" class="form-input" id="editEventStartDate" value="${event.startDate.replace(' ', 'T')}" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">End Date</label>
                    <input type="datetime-local" class="form-input" id="editEventEndDate" value="${event.endDate.replace(' ', 'T')}" required>
                </div>
                
                <div class="form-group full-width">
                    <label class="form-label">Event Description</label>
                    <textarea class="form-textarea" id="editEventDescription" placeholder="Enter event description">${event.description || ''}</textarea>
                </div>
                
                <div class="form-group full-width">
                    <label class="form-label">Event Image</label>
                    <div class="image-upload" id="editImageUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload or drag and drop</p>
                        <p class="form-hint">JPG, PNG, GIF, WebP, SVG (max 2MB)</p>
                        <input type="file" id="editEventImage" accept="image/*">
                    </div>
                    <div class="image-preview" id="editImagePreview" style="${event.image ? 'display: block;' : 'display: none;'}">
                        <img src="${event.image}" alt="Preview">
                    </div>
                </div>
            </div>
        </form>
    `;
    
    modal.querySelector('.modal-body').innerHTML = '';
    modal.querySelector('.modal-body').appendChild(formContent);
    
    // Set current image
    currentImage = event.image;
    currentEditId = eventId;
    
    // Setup image upload listeners untuk modal edit
    setTimeout(() => {
        const editImageUpload = document.getElementById('editImageUpload');
        const editImageInput = document.getElementById('editEventImage');
        const editImagePreview = document.getElementById('editImagePreview');
        
        if (editImageUpload && editImageInput) {
            editImageUpload.addEventListener('click', () => {
                editImageInput.click();
            });
            
            editImageInput.addEventListener('change', (e) => {
                handleImageUpload(e, (imageUrl) => {
                    if (editImagePreview) {
                        editImagePreview.querySelector('img').src = imageUrl;
                        editImagePreview.style.display = 'block';
                        currentImage = imageUrl;
                    }
                });
            });
        }
    }, 100);
    
    modal.classList.add('active');
}

// Close edit event modal
function closeEditEventModal() {
    const modal = document.getElementById('editEventModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// View event details
function viewEvent(eventId) {
    const event = events.find(e => e.id === eventId);
    if (!event) return;
    
    const modal = document.getElementById('eventDetailsModal');
    if (!modal) return;
    
    // Set modal title
    modal.querySelector('.modal-title').innerHTML = `<i class="fas fa-info-circle"></i> ${event.title}`;
    
    // Create details content
    const detailsContent = document.createElement('div');
    detailsContent.innerHTML = `
        <div class="event-details">
            <div class="event-image" style="margin-bottom: 20px;">
                <img src="${event.image || 'https://via.placeholder.com/300x180?text=Event+Image'}" alt="${event.title}" style="width: 100%; border-radius: 8px;">
            </div>
            
            <div class="detail-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="detail-item">
                    <strong>Category:</strong> ${event.category}
                </div>
                <div class="detail-item">
                    <strong>Provider:</strong> ${event.provider || 'N/A'}
                </div>
                <div class="detail-item">
                    <strong>Status:</strong> ${event.status}
                </div>
                <div class="detail-item">
                    <strong>Start Date:</strong> ${formatDisplayDateTime(event.startDate)}
                </div>
                <div class="detail-item">
                    <strong>End Date:</strong> ${formatDisplayDateTime(event.endDate)}
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <strong>Description:</strong>
                <p>${event.description || 'No description available.'}</p>
            </div>
        </div>
    `;
    
    modal.querySelector('#eventDetailsContainer').innerHTML = '';
    modal.querySelector('#eventDetailsContainer').appendChild(detailsContent);
    
    // Set event ID for edit button
    modal.querySelector('#editFromDetails').dataset.id = eventId;
    
    modal.classList.add('active');
}

// Close event details modal
function closeEventDetailsModal() {
    const modal = document.getElementById('eventDetailsModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Save new event
async function saveNewEvent() {
    const title = document.getElementById('eventTitle')?.value.trim();
    const category = document.getElementById('eventCategory')?.value;
    const provider = document.getElementById('eventProvider')?.value;
    const startDate = document.getElementById('eventStartDate')?.value;
    const endDate = document.getElementById('eventEndDate')?.value;
    const status = document.getElementById('eventStatus')?.value;
    const description = document.getElementById('eventDescription')?.value.trim();
    
    console.log('Saving event:', { title, category, provider, startDate, endDate, status });
    
    // Basic validation
    if (!title || !category || !provider || !startDate || !endDate) {
        showNotification('Please fill in all required fields.', 'error');
        return;
    }
    
    if (new Date(startDate) >= new Date(endDate)) {
        showNotification('End date must be after start date.', 'error');
        return;
    }
    
    try {
        const eventData = {
            title,
            category,
            provider,
            startDate: startDate.replace('T', ' '),
            endDate: endDate.replace('T', ' '),
            status: status || 'active',
            description: description || '',
            image: currentImage || 'https://via.placeholder.com/300x180?text=Event+Image',
            participants: 0
        };
        
        await addEvent(eventData);
        closeAddEventModal();
        
    } catch (error) {
        console.error("Error saving event:", error);
        // Error notification is handled in addEvent function
    }
}

// Update existing event
async function updateExistingEvent() {
    if (!currentEditId) return;
    
    const title = document.getElementById('editEventTitle')?.value.trim();
    const category = document.getElementById('editEventCategory')?.value;
    const provider = document.getElementById('editEventProvider')?.value;
    const startDate = document.getElementById('editEventStartDate')?.value;
    const endDate = document.getElementById('editEventEndDate')?.value;
    const status = document.getElementById('editEventStatus')?.value;
    const description = document.getElementById('editEventDescription')?.value.trim();
    
    // Basic validation
    if (!title || !category || !provider || !startDate || !endDate) {
        showNotification('Please fill in all required fields.', 'error');
        return;
    }
    
    if (new Date(startDate) >= new Date(endDate)) {
        showNotification('End date must be after start date.', 'error');
        return;
    }
    
    try {
        const eventData = {
            title,
            category,
            provider,
            startDate: startDate.replace('T', ' '),
            endDate: endDate.replace('T', ' '),
            status,
            description,
            image: currentImage || 'https://via.placeholder.com/300x180?text=Event+Image'
        };
        
        await updateEvent(currentEditId, eventData);
        closeEditEventModal();
        
    } catch (error) {
        console.error("Error updating event:", error);
        // Error notification is handled in updateEvent function
    }
}

// ========== EVENT LISTENERS SETUP ==========
function setupEventListeners() {
    // Filter event listeners
    document.getElementById('statusFilter')?.addEventListener('change', loadEvents);
    document.getElementById('categoryFilter')?.addEventListener('change', loadEvents);
    document.getElementById('providerFilter')?.addEventListener('change', loadEvents);
    document.getElementById('dateFrom')?.addEventListener('change', loadEvents);
    document.getElementById('dateTo')?.addEventListener('change', loadEvents);
    document.getElementById('sortBy')?.addEventListener('change', loadEvents);
    document.getElementById('sortOrder')?.addEventListener('change', loadEvents);
    
    // Search input with debounce
    const searchInput = document.getElementById('eventsSearch');
    if (searchInput) {
        searchInput.addEventListener('input', debounce(loadEvents, 300));
    }
    
    // Reset filters
    document.getElementById('resetFilters')?.addEventListener('click', resetFilters);
    
    // Toggle advanced filters
    document.getElementById('toggleAdvancedFilters')?.addEventListener('click', toggleAdvancedFilters);
    
    // Refresh events
    document.getElementById('refreshEvents')?.addEventListener('click', () => {
        loadEvents();
        showNotification('Events list refreshed', 'success');
    });
    
    // Add event button
    document.getElementById('addEventBtn')?.addEventListener('click', openAddEventModal);
    document.getElementById('addFirstEvent')?.addEventListener('click', openAddEventModal);
    
    // Modal close buttons
    document.getElementById('closeAddModal')?.addEventListener('click', closeAddEventModal);
    document.getElementById('closeEditModal')?.addEventListener('click', closeEditEventModal);
    document.getElementById('closeDetailsModal')?.addEventListener('click', closeEventDetailsModal);
    document.getElementById('cancelAddEvent')?.addEventListener('click', closeAddEventModal);
    document.getElementById('cancelEditEvent')?.addEventListener('click', closeEditEventModal);
    document.getElementById('closeDetails')?.addEventListener('click', closeEventDetailsModal);
    
    // Modal save/update buttons
    document.getElementById('saveEvent')?.addEventListener('click', saveNewEvent);
    document.getElementById('updateEvent')?.addEventListener('click', updateExistingEvent);
    document.getElementById('deleteEvent')?.addEventListener('click', () => {
        if (currentEditId) {
            deleteEvent(currentEditId);
            closeEditEventModal();
        }
    });
    
    // Edit from details modal
    document.getElementById('editFromDetails')?.addEventListener('click', function() {
        const eventId = this.dataset.id;
        closeEventDetailsModal();
        if (eventId) {
            setTimeout(() => openEditEventModal(eventId), 300);
        }
    });
    
    // Image upload handling
    setupImageUploadListeners();
    
    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
        const addModal = document.getElementById('addEventModal');
        const editModal = document.getElementById('editEventModal');
        const detailsModal = document.getElementById('eventDetailsModal');
        
        if (e.target === addModal) closeAddEventModal();
        if (e.target === editModal) closeEditEventModal();
        if (e.target === detailsModal) closeEventDetailsModal();
    });
    

}

// ========== UTILITY FUNCTIONS ==========
// Debounce function for search input
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing events...');
    
    // Initialize Firebase auth state listener
    checkAuthState();
});

// Function to add sample data (for demo purposes)
function addSampleData() {
    const sampleEvents = [
        {
            title: "Summer Tournament",
            category: "Tournament",
            provider: "PG SOFT",
            startDate: "2023-07-15 14:00:00",
            endDate: "2023-07-15 18:00:00",
            status: "upcoming",
            description: "Annual summer gaming tournament with great prizes.",
            image: "https://via.placeholder.com/300x180?text=Summer+Tournament",
            participants: 0
        },
        {
            title: "Double XP Weekend",
            category: "Promotion",
            provider: "PRAGMATIC PLAY",
            startDate: "2023-07-22 00:00:00",
            endDate: "2023-07-24 23:59:59",
            status: "active",
            description: "Earn double XP on all games this weekend!",
            image: "https://via.placeholder.com/300x180?text=Double+XP+Weekend",
            participants: 0
        },
        {
            title: "Championship Finals",
            category: "Competition",
            provider: "JOKER",
            startDate: "2023-08-05 16:00:00",
            endDate: "2023-08-05 20:00:00",
            status: "upcoming",
            description: "Finals of the annual gaming championship.",
            image: "https://via.placeholder.com/300x180?text=Championship+Finals",
            participants: 0
        }
    ];
    
    // Check if we need to add sample data
    if (events.length === 0) {
        sampleEvents.forEach(event => {
            addEvent(event).catch(error => {
                console.error("Error adding sample event:", error);
            });
        });
    }
}
</script>
</body>
</html>