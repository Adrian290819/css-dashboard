<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Account - CSS Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="global.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
/* ===== VISUAL ENHANCEMENTS ===== */

/* Main Content Layout Enhancement */
.main-content {
    padding: var(--space-lg);
    background-color: var(--bg-secondary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.content-wrapper {
    width: 100%;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Header Visual Enhancement */
.header {
    background: var(--card-bg);
    border-radius: 16px;
    padding: var(--space-xl);
    margin-bottom: var(--space-lg);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    overflow: hidden;
    width: 100%;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 6px;
    height: 100%;
    background: var(--primary-gradient);
}

.header h1 {
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin: 0;
}

.header h1 i {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Search Bar Visual Enhancement */
.search-bar {
    position: relative;
    display: flex;
    align-items: center;
}

.search-bar i {
    position: absolute;
    left: 14px;
    color: var(--text-secondary);
    z-index: 2;
}

.search-bar input {
    padding: 12px 16px 12px 44px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    width: 280px;
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.search-bar input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 2px 12px rgba(67, 97, 238, 0.15);
}

/* User Profile Visual Enhancement */
.user-profile {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: 8px 16px;
    border-radius: 12px;
    background: rgba(67, 97, 238, 0.05);
    border: 1px solid rgba(67, 97, 238, 0.1);
    transition: all var(--transition-fast);
}

.user-profile:hover {
    background: rgba(67, 97, 238, 0.1);
    transform: translateY(-2px);
}

.profile-img {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(67, 97, 238, 0.2);
}

.user-info h4 {
    font-weight: var(--font-semibold);
    font-size: var(--text-sm);
    color: var(--text-primary);
    margin: 0;
}

.user-info p {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin: 0;
}

/* Staff Container Visual Enhancement */
.staff-container {
    background: var(--card-bg);
    border-radius: 16px;
    padding: var(--space-xl);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    margin-bottom: var(--space-xl);
    transition: all var(--transition-normal);
    width: 100%;
}

.staff-container:hover {
    box-shadow: var(--card-shadow-hover);
}

/* Section Header Visual Enhancement */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xl);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
    flex-wrap: wrap;
    gap: var(--space-md);
}

.section-title {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin: 0;
}

.section-title i {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Filter Controls Visual Enhancement */
.filter-controls {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.filter-label {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-input {
    padding: 10px 14px;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    min-width: 160px;
}

.filter-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 2px 12px rgba(67, 97, 238, 0.15);
}

/* Button Visual Enhancement */
.btn {
    padding: 12px 20px;
    border-radius: 10px;
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    cursor: pointer;
    transition: all var(--transition-fast);
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.btn-primary {
    background: var(--primary-gradient);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
}

.btn-outline {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.btn-outline:hover {
    background: var(--hover-color);
    color: var(--text-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-success {
    background: var(--success-gradient);
    color: white;
}

.btn-warning {
    background: var(--warning-gradient);
    color: white;
}

.btn-danger {
    background: var(--danger-gradient);
    color: white;
}

.btn-sm {
    padding: 8px 14px;
    font-size: var(--text-xs);
}

/* Staff List Visual Enhancement */
.staff-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

/* Staff Item Visual Enhancement */
.staff-item {
    background: var(--card-bg);
    border-radius: 14px;
    padding: var(--space-lg);
    border: 1px solid var(--border-color);
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    position: relative;
    overflow: hidden;
}

.staff-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary);
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.staff-item:hover {
    box-shadow: var(--card-shadow);
    transform: translateY(-4px);
    border-color: rgba(67, 97, 238, 0.2);
}

.staff-item:hover::before {
    opacity: 1;
}

.staff-item.suspended {
    background-color: rgba(107, 114, 128, 0.03);
    border-left: 4px solid var(--suspended-color);
}

.staff-item.suspended::before {
    display: none;
}

/* Staff Header Visual Enhancement */
.staff-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-md);
}

.staff-info {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.staff-avatar {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid rgba(67, 97, 238, 0.1);
    transition: all var(--transition-fast);
}

.staff-item:hover .staff-avatar {
    border-color: rgba(67, 97, 238, 0.3);
    transform: scale(1.05);
}

.staff-details h3 {
    font-weight: var(--font-semibold);
    font-size: var(--text-md);
    color: var(--text-primary);
    margin: 0 0 6px 0;
}

.staff-details p {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin: 0;
}

/* Staff Status Visual Enhancement */
.staff-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

.status-active {
    background: rgba(16, 185, 129, 0.12);
    color: var(--completed-color);
    border: 1px solid rgba(16, 185, 129, 0.2);
}

.status-suspended {
    background: rgba(107, 114, 128, 0.12);
    color: var(--suspended-color);
    border: 1px solid rgba(107, 114, 128, 0.2);
}

.status-pending {
    background: rgba(245, 158, 11, 0.12);
    color: var(--pending-color);
    border: 1px solid rgba(245, 158, 11, 0.2);
}

/* Staff Meta Visual Enhancement */
.staff-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-lg);
    margin-bottom: var(--space-md);
    padding: 12px 0;
    border-top: 1px solid var(--border-color-light);
    border-bottom: 1px solid var(--border-color-light);
}

.staff-role, .staff-email, .staff-joined {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: var(--text-xs);
    color: var(--text-secondary);
    background: rgba(0, 0, 0, 0.02);
    padding: 6px 12px;
    border-radius: 8px;
}

/* Staff Actions Visual Enhancement */
.staff-actions {
    display: flex;
    gap: var(--space-sm);
    padding-top: var(--space-md);
    flex-wrap: wrap;
}

/* Empty State Visual Enhancement */
.empty-state {
    text-align: center;
    padding: var(--space-xxl) var(--space-lg);
    background-color: var(--card-bg);
    border-radius: 16px;
    border: 2px dashed var(--border-color);
    margin: var(--space-lg) 0;
    transition: all var(--transition-fast);
}

.empty-state:hover {
    border-color: var(--primary);
    background: rgba(67, 97, 238, 0.02);
}

.empty-state i {
    font-size: 4rem;
    color: var(--text-tertiary);
    margin-bottom: var(--space-md);
    opacity: 0.7;
}

.empty-state h3 {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.empty-state p {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin-bottom: var(--space-lg);
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}


/* Animations */
@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes modalSlideIn {
    from { 
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to { 
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Form styling improvements */
.form-group {
    margin-bottom: var(--space-lg);
}

.form-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.form-input {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 2px 12px rgba(67, 97, 238, 0.15);
}

/* Modal header improvements */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
}

.modal-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.modal-close {
    background: none;
    border: none;
    font-size: var(--text-lg);
    color: var(--text-secondary);
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
}

.modal-close:hover {
    background: var(--hover-color);
    color: var(--text-primary);
    transform: rotate(90deg);
}

/* Form actions */
.form-actions {
    display: flex;
    gap: var(--space-sm);
    justify-content: flex-end;
    margin-top: var(--space-xl);
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-color);
}

/* Responsive modal */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        padding: var(--space-lg);
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn {
        width: 100%;
    }
}

/* Form Visual Enhancement */
.form-group {
    margin-bottom: var(--space-lg);
}

.form-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.form-input {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 2px 12px rgba(67, 97, 238, 0.15);
}

.form-actions {
    display: flex;
    gap: var(--space-sm);
    justify-content: flex-end;
    margin-top: var(--space-xl);
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-color);
}

/* Notification Visual Enhancement */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.notification {
    padding: 16px 20px;
    border-radius: 12px;
    background: var(--card-bg);
    border-left: 4px solid var(--primary);
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    gap: 12px;
    animation: notificationSlideIn 0.5s ease forwards;
    max-width: 380px;
    position: relative;
}

.notification.success {
    border-left-color: var(--completed-color);
}

.notification.error {
    border-left-color: var(--overdue-color);
}

.notification.info {
    border-left-color: var(--primary);
}

.notification button.notification-close {
    background: none;
    border: none;
    cursor: pointer;
    margin-left: auto;
    color: var(--text-secondary);
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
}

.notification button.notification-close:hover {
    color: var(--text-primary);
    background-color: rgba(0, 0, 0, 0.1);
}

.notification.hiding {
    animation: notificationSlideOut 0.5s ease forwards;
}

@keyframes notificationSlideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes notificationSlideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.fade-in {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Loading Animation */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Staff Detail Modal Styles */
.staff-detail-view {
    padding: var(--space-md);
}

.staff-detail-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
}

.staff-detail-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
}

.staff-detail-info h3 {
    margin: 0 0 var(--space-xs) 0;
    font-size: var(--text-lg);
    color: var(--text-primary);
}

.staff-detail-info p {
    margin: 0 0 var(--space-sm) 0;
    color: var(--text-secondary);
}

.staff-detail-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.detail-item {
    display: flex;
    justify-content: space-between;
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--border-color-light);
}

.detail-item label {
    font-weight: var(--font-medium);
    color: var(--text-primary);
}

.detail-item span {
    color: var(--text-secondary);
}

/* Additional CSS Variables untuk enhancement */
:root {
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    --card-shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;
    --space-xxl: 48px;
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-md: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;
    --text-2xl: 1.5rem;
    --font-light: 300;
    --font-normal: 400;
    --font-medium: 500;
    --font-semibold: 600;
    --font-bold: 700;
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
}


/* Responsive design for detail modal */
@media (max-width: 768px) {
    .staff-detail-header {
        flex-direction: column;
        text-align: center;
    }
    
    .staff-detail-info {
        text-align: center;
    }
    
    .detail-item {
        flex-direction: column;
        gap: var(--space-xs);
        align-items: flex-start;
    }
    
    .detail-item label {
        font-weight: var(--font-bold);
    }
}
/* ===== MODAL POSITIONING FIX ===== */
.modal {
    display: none !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0, 0, 0, 0.5) !important;
    z-index: 9999 !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 20px !important;
    box-sizing: border-box !important;
}

.modal.active {
    display: flex !important;
}

.modal-content {
    background: var(--card-bg) !important;
    border-radius: 20px !important;
    padding: var(--space-xl) !important;
    box-shadow: var(--shadow-lg) !important;
    border: 1px solid var(--border-color) !important;
    width: 90% !important;
    max-width: 500px !important;
    max-height: 90vh !important;
    overflow-y: auto !important;
    margin: 0 !important;
    position: relative !important;
    animation: modalSlideIn 0.3s ease forwards !important;
    box-sizing: border-box !important;
}

/* Animations */
@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes modalSlideIn {
    from { 
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to { 
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Modal header improvements */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
}

.modal-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.modal-close {
    background: none;
    border: none;
    font-size: var(--text-lg);
    color: var(--text-secondary);
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
}

.modal-close:hover {
    background: var(--hover-color);
    color: var(--text-primary);
    transform: rotate(90deg);
}

/* Form styling improvements */
.form-group {
    margin-bottom: var(--space-lg);
}

.form-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
}

.form-input {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: all var(--transition-fast);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 2px 12px rgba(67, 97, 238, 0.15);
}

/* Form actions */
.form-actions {
    display: flex;
    gap: var(--space-sm);
    justify-content: flex-end;
    margin-top: var(--space-xl);
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-color);
}

/* Modal body */
.modal-body {
    max-height: 60vh;
    overflow-y: auto;
    padding: var(--space-md) 0;
}

/* Responsive modal */
@media (max-width: 768px) {
    .modal-content {
        width: 95% !important;
        padding: var(--space-lg) !important;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn {
        width: 100%;
    }
}

/* Staff Detail Modal Styles */
.staff-detail-view {
    padding: var(--space-md);
}

.staff-detail-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
}

.staff-detail-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
}

.staff-detail-info h3 {
    margin: 0 0 var(--space-xs) 0;
    font-size: var(--text-lg);
    color: var(--text-primary);
}

.staff-detail-info p {
    margin: 0 0 var(--space-sm) 0;
    color: var(--text-secondary);
}

.staff-detail-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.detail-item {
    display: flex;
    justify-content: space-between;
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--border-color-light);
}

.detail-item label {
    font-weight: var(--font-medium);
    color: var(--text-primary);
}

.detail-item span {
    color: var(--text-secondary);
}

/* Responsive design for detail modal */
@media (max-width: 768px) {
    .staff-detail-header {
        flex-direction: column;
        text-align: center;
    }
    
    .staff-detail-info {
        text-align: center;
    }
    
    .detail-item {
        flex-direction: column;
        gap: var(--space-xs);
        align-items: flex-start;
    }
    
    .detail-item label {
        font-weight: var(--font-bold);
    }
}

    </style>
</head>
<body>
    <div id="sidebar-container"></div>
    <button class="menu-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1><i class="fas fa-user-friends"></i> Staff Account Management</h1>
            <div class="header-actions">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Cari staff..." id="searchStaff">
                </div>
                <div class="user-profile">
                    <img class="profile-img" src="https://iili.io/Fpiva7S.png" alt="Profile" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiM0MzYxRUUiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDExQzE0LjIwOTEgMTEgMTYgOS4yMDkxIDE2IDdDMTYgNC43OTA4NiAxNC4yMDkxIDMgMTIgM0M5Ljc5MDg2IDMgOCA0Ljc5MDg2IDggN0M4IDkuMjA5MSA5Ljc5MDg2IDExIDEyIDExWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTYgMTlDNiAxNi43OTA5IDcuNzkwODYgMTUgMTAgMTVIMTVDMTcuMjA5MSAxNSAxOSAxNi43OTA5IDE5IDE5VjIwQzE5IDIxLjEwNDYgMTguMTA0NiAyMiAxNyAyMkg4QzYuODk1NDMgMjIgNiAyMS4xMDQ2IDYgMjBWMTlaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+'">
                    <div class="user-info">
                        <h4>Nama Masing Masing</h4>
                        <p>Customer Service Support</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="staff-container fade-in">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-users"></i> Daftar Staff</h2>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label" for="filterRole">Filter Role</label>
                        <select id="filterRole" class="filter-input">
                            <option value="">Semua Role</option>
                            <option value="super_admin">Super Admin</option>
                            <option value="admin">Admin</option>
                            <option value="staff">Staff</option>
                            <option value="support">Support</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" for="filterStatus">Filter Status</label>
                        <select id="filterStatus" class="filter-input">
                            <option value="">Semua Status</option>
                            <option value="active">Aktif</option>
                            <option value="suspended">Suspended</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="addStaffBtn">
                        <i class="fas fa-plus"></i> Tambah Staff
                    </button>
                </div>
            </div>
            
            <div class="staff-list" id="staffList">
                <!-- Staff data akan dimuat di sini -->
            </div>
            
            <div class="empty-state" id="emptyState">
                <i class="fas fa-users"></i>
                <h3>Tidak ada data staff</h3>
                <p>Belum ada staff yang terdaftar atau data sesuai dengan filter yang dipilih.</p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addStaffModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-user-plus"></i> Tambah Staff Baru</h3>
            <button class="modal-close" onclick="closeModal('addStaffModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="addStaffForm">
            <div class="form-group">
                <label class="form-label" for="staffName">Nama Lengkap</label>
                <input type="text" id="staffName" class="form-input" required placeholder="Masukkan nama lengkap">
            </div>
            <div class="form-group">
                <label class="form-label" for="staffEmail">Email</label>
                <input type="email" id="staffEmail" class="form-input" required placeholder="Masukkan email">
            </div>
            <div class="form-group">
                <label class="form-label" for="staffRole">Role</label>
                <select id="staffRole" class="form-input" required>
                    <option value="staff">Staff</option>
                    <option value="admin">Admin</option>
                    <option value="support">Support</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="staffPassword">Password</label>
                <input type="password" id="staffPassword" class="form-input" required minlength="6" placeholder="Minimal 6 karakter">
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('addStaffModal')">Batal</button>
                <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
        </form>
    </div>
</div>

    <div class="modal" id="resetPasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reset Password</h3>
                <button class="modal-close" onclick="closeModal('resetPasswordModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="resetPasswordForm">
                <input type="hidden" id="resetStaffId">
                <div class="form-group">
                    <label class="form-label" for="newPassword">Password Baru</label>
                    <input type="password" id="newPassword" class="form-input" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Konfirmasi Password</label>
                    <input type="password" id="confirmPassword" class="form-input" required minlength="6">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('resetPasswordModal')">Batal</button>
                    <button type="submit" class="btn btn-primary">Reset Password</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="suspendModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="suspendModalTitle">Konfirmasi</h3>
                <button class="modal-close" onclick="closeModal('suspendModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <p id="suspendModalMessage">Apakah Anda yakin ingin melakukan tindakan ini?</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('suspendModal')">Batal</button>
                <button type="button" class="btn btn-danger" id="confirmSuspendBtn">Konfirmasi</button>
            </div>
        </div>
    </div>

    <div class="notification-container" id="notificationContainer"></div>
    
    <script src="sidebar-loader.js"></script>
    <script src="user-profile.js"></script>
    <script>

    // ===== FIREBASE INITIALIZATION =====
const firebaseConfig = {
    apiKey: "AIzaSyDUZka4FZyLi_cv6X_5D4zeRsfkpqOlBpY",
    authDomain: "dashboard-css.firebaseapp.com",
    databaseURL: "https://dashboard-css-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "dashboard-css",
    storageBucket: "dashboard-css.appspot.com",
    messagingSenderId: "771131792881",
    appId: "1:771131792881:web:ad634424225bd7de847850",
    measurementId: "G-3CYBC5B101"
};

// Initialize Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
    console.log("Firebase initialized successfully");
}

// Buat variabel global untuk akses mudah
window.auth = firebase.auth();
window.db = firebase.firestore();

const auth = window.auth;
const db = window.db;

    // ===== STAFF ACCOUNT MANAGER =====
    class StaffAccountManager {
        constructor() {
            this.staffData = [];
            this.currentUser = null;
            this.currentAction = null;
            this.unsubscribeListener = null;
            
            this.initializeEventListeners();
            this.loadStaffData();
            this.loadCurrentUserProfile();
            this.addDetailModalStyles();
            this.setupRealTimeListener();
        }
        setupRealTimeListener() {
    if (!db) return;
    
    // Real-time listener untuk update data user
    db.collection('users').onSnapshot((snapshot) => {
        console.log("ðŸ”„ Real-time update received for users");
        this.loadStaffData(); // Reload data
    }, (error) => {
        console.error("Error in real-time listener:", error);
    });
}

        // Fungsi untuk mengambil profil pengguna saat ini
        loadCurrentUserProfile() {
            try {
                const savedName = localStorage.getItem('adminName');
                const savedImage = localStorage.getItem('adminProfileImage');
                const savedRole = localStorage.getItem('adminRole');
                
                console.log("Loading user profile:", { savedName, savedImage, savedRole });
                
                if (savedName) {
                    const userInfoElements = document.querySelectorAll('.user-info h4');
                    userInfoElements.forEach(el => {
                        el.textContent = savedName;
                    });
                }
                
                if (savedImage) {
                    const profileImages = document.querySelectorAll('.profile-img');
                    profileImages.forEach(img => {
                        img.src = savedImage;
                    });
                }
                
                if (savedRole) {
                    const roleElements = document.querySelectorAll('.user-info p');
                    roleElements.forEach(el => {
                        el.textContent = savedRole;
                    });
                }
            } catch (error) {
                console.error("Error loading current user profile:", error);
            }
        }

        initializeEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('searchStaff');
            const filterRole = document.getElementById('filterRole');
            const filterStatus = document.getElementById('filterStatus');
            
            if (searchInput) {
                searchInput.addEventListener('input', () => this.filterStaff());
            }
            if (filterRole) {
                filterRole.addEventListener('change', () => this.filterStaff());
            }
            if (filterStatus) {
                filterStatus.addEventListener('change', () => this.filterStaff());
            }
            
            // Add staff modal
            const addStaffBtn = document.getElementById('addStaffBtn');
            const addStaffForm = document.getElementById('addStaffForm');
            
            if (addStaffBtn) {
                addStaffBtn.addEventListener('click', () => this.openAddStaffModal());
            }
            if (addStaffForm) {
                addStaffForm.addEventListener('submit', (e) => this.handleAddStaff(e));
            }
            
            // Reset password modal
            const resetPasswordForm = document.getElementById('resetPasswordForm');
            if (resetPasswordForm) {
                resetPasswordForm.addEventListener('submit', (e) => this.handleResetPassword(e));
            }
            
            // Suspend modal confirmation
            const confirmSuspendBtn = document.getElementById('confirmSuspendBtn');
            if (confirmSuspendBtn) {
                confirmSuspendBtn.addEventListener('click', () => this.handleConfirmAction());
            }
        }

        // Fungsi untuk memetakan status dari Firestore ke kode
        normalizeStatus(firestoreStatus) {
            const statusMap = {
                'Active': 'active',
                'Suspended': 'suspended',
                'Pending': 'pending',
                'active': 'active',
                'suspended': 'suspended',
                'pending': 'pending'
            };
            return statusMap[firestoreStatus] || 'active';
        }

        // Fungsi untuk memetakan status dari kode ke Firestore
        denormalizeStatus(normalizedStatus) {
            const statusMap = {
                'active': 'Active',
                'suspended': 'Suspended',
                'pending': 'Pending'
            };
            return statusMap[normalizedStatus] || 'Active';
        }

        // Fungsi untuk memetakan role dari Firestore ke kode
        normalizeRole(firestoreRole) {
            const roleMap = {
                'Customers Service Support': 'staff',
                'Customer Service Support': 'staff',
                'Super Admin': 'super_admin',
                'Admin': 'admin',
                'Support': 'support',
                'staff': 'staff',
                'admin': 'admin',
                'support': 'support',
                'super_admin': 'super_admin'
            };
            return roleMap[firestoreRole] || 'staff';
        }

        // Fungsi untuk memetakan role dari kode ke Firestore
        denormalizeRole(normalizedRole) {
            const roleMap = {
                'staff': 'Customer Service Support',
                'admin': 'Admin',
                'support': 'Support',
                'super_admin': 'Super Admin'
            };
            return roleMap[normalizedRole] || 'Customer Service Support';
        }

        // Fungsi untuk mendapatkan nama dari Firestore data
        getNameFromFirestoreData(data) {
            return data.name || data.displayName || data.email || 'Unknown User';
        }

        async loadStaffData() {
            try {
                this.showLoading(true);
                
                // Coba load dari Firebase terlebih dahulu
                if (db) {
                    await this.loadFromFirebase();
                } else {
                    // Fallback ke localStorage
                    this.loadFromLocalStorage();
                }
                
                this.renderStaffList();
                this.showLoading(false);
                
            } catch (error) {
                console.error("Error loading staff data:", error);
                this.loadFromLocalStorage();
                this.renderStaffList();
                this.showLoading(false);
            }
        }

        async loadFromFirebase() {
    try {
        const snapshot = await db.collection('users').get();
        this.staffData = snapshot.docs.map(doc => {
            const data = doc.data();
            console.log(`Loading user ${doc.id}:`, data);
            
            // Handle lastLogin dengan lebih baik
            let lastLogin = null;
            if (data.lastLogin) {
                if (data.lastLogin.toDate) {
                    // Firestore Timestamp
                    lastLogin = data.lastLogin;
                } else if (typeof data.lastLogin === 'object' && data.lastLogin._seconds) {
                    // Firebase Timestamp object
                    lastLogin = data.lastLogin;
                } else if (data.lastLogin.seconds) {
                    // Timestamp dalam seconds
                    lastLogin = {
                        toDate: () => new Date(data.lastLogin.seconds * 1000),
                        _seconds: data.lastLogin.seconds
                    };
                } else if (typeof data.lastLogin === 'string') {
                    // String ISO
                    lastLogin = new Date(data.lastLogin);
                }
            }
            
            // Normalisasi data dari Firestore
            return {
                id: doc.id,
                name: this.getNameFromFirestoreData(data),
                email: data.email || '',
                role: this.normalizeRole(data.role),
                status: this.normalizeStatus(data.status),
                avatar: data.image || data.avatar || 'https://iili.io/KfDh0EN.png',
                joinDate: data.createdate ? this.formatFirestoreDate(data.createdate) : new Date().toISOString().split('T')[0],
                lastLogin: lastLogin, // Simpan object asli, bukan string
                firestoreData: data
            };
        });
        console.log("Loaded staff data from Firebase:", this.staffData.length, "users");
        
        // Log data untuk debugging
        this.staffData.forEach(staff => {
            console.log(`${staff.name}: lastLogin =`, staff.lastLogin);
        });
        
    } catch (error) {
        console.error("Error loading from Firebase:", error);
        throw error;
    }
}

        // Format tanggal dari Firestore
        formatFirestoreDate(timestamp) {
            if (!timestamp) return new Date().toISOString().split('T')[0];
            
            try {
                // Jika timestamp adalah Firestore Timestamp
                if (timestamp.toDate) {
                    return timestamp.toDate().toISOString().split('T')[0];
                }
                // Jika sudah string
                if (typeof timestamp === 'string') {
                    return timestamp.split('T')[0];
                }
                return new Date().toISOString().split('T')[0];
            } catch (error) {
                console.error("Error formatting Firestore date:", error);
                return new Date().toISOString().split('T')[0];
            }
        }

        loadFromLocalStorage() {
            const savedData = localStorage.getItem('staffAccounts');
            if (savedData) {
                this.staffData = JSON.parse(savedData);
            } else {
                // Data sample default
                this.staffData = [
                    {
                        id: '1',
                        name: 'Adrian Abdul Arif',
                        email: 'adrian@company.com',
                        role: 'super_admin',
                        status: 'active',
                        avatar: 'https://iili.io/Fpiva7S.png',
                        joinDate: '2024-01-01',
                        lastLogin: '2024-01-15 10:30'
                    },
                    {
                        id: '2',
                        name: 'Jane Smith',
                        email: 'jane@company.com',
                        role: 'admin',
                        status: 'active',
                        avatar: 'https://iili.io/KfDh0EN.png',
                        joinDate: '2024-01-05',
                        lastLogin: '2024-01-14 15:20'
                    },
                    {
                        id: '3',
                        name: 'John Doe',
                        email: 'john@company.com',
                        role: 'staff',
                        status: 'suspended',
                        avatar: 'https://iili.io/KfDh0EN.png',
                        joinDate: '2024-01-10',
                        lastLogin: '2024-01-12 09:15'
                    }
                ];
                this.saveToLocalStorage();
            }
        }

        saveToLocalStorage() {
            localStorage.setItem('staffAccounts', JSON.stringify(this.staffData));
        }

        renderStaffList(staffToRender = null) {
            const staffList = document.getElementById('staffList');
            const emptyState = document.getElementById('emptyState');
            
            if (!staffList || !emptyState) {
                console.error("Required DOM elements not found");
                return;
            }
            
            let staff = staffToRender || this.staffData;
            
            // Apply filters
            staff = this.applyFilters(staff);
            
            if (staff.length === 0) {
                emptyState.style.display = 'block';
                staffList.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            staffList.style.display = 'flex';
            staffList.innerHTML = '';
            
            staff.forEach(staffMember => {
                const staffItem = this.createStaffItem(staffMember);
                staffList.appendChild(staffItem);
            });
        }

        applyFilters(staff) {
            const searchInput = document.getElementById('searchStaff');
            const filterRole = document.getElementById('filterRole');
            const filterStatus = document.getElementById('filterStatus');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const roleValue = filterRole ? filterRole.value : '';
            const statusValue = filterStatus ? filterStatus.value : '';
            
            return staff.filter(staffMember => {
                // Search filter
                if (searchTerm && !(
                    staffMember.name.toLowerCase().includes(searchTerm) ||
                    staffMember.email.toLowerCase().includes(searchTerm)
                )) {
                    return false;
                }
                
                // Role filter
                if (roleValue && staffMember.role !== roleValue) {
                    return false;
                }
                
                // Status filter
                if (statusValue && staffMember.status !== statusValue) {
                    return false;
                }
                
                return true;
            });
        }

        createStaffItem(staffMember) {
            const staffItem = document.createElement('div');
            staffItem.className = `staff-item ${staffMember.status === 'suspended' ? 'suspended' : ''} fade-in`;
            
            const statusText = this.getStatusText(staffMember.status);
            const roleText = this.getRoleText(staffMember.role);
            const formattedDate = this.formatDate(staffMember.joinDate);
            
            staffItem.innerHTML = `
                <div class="staff-header">
                    <div class="staff-info">
                        <img class="staff-avatar" src="${staffMember.avatar}" alt="${staffMember.name}" onerror="this.src='https://iili.io/KfDh0EN.png'">
                        <div class="staff-details">
                            <h3>${staffMember.name}</h3>
                            <p>${staffMember.email}</p>
                        </div>
                    </div>
                    <span class="staff-status status-${staffMember.status}">
                        <i class="fas ${this.getStatusIcon(staffMember.status)}"></i>
                        ${statusText}
                    </span>
                </div>
                <div class="staff-meta">
                    <span class="staff-role">
                        <i class="fas fa-user-tag"></i> ${roleText}
                    </span>
                    <span class="staff-email">
                        <i class="fas fa-envelope"></i> ${staffMember.email}
                    </span>
                    <span class="staff-joined">
                        <i class="fas fa-calendar-plus"></i> Bergabung: ${formattedDate}
                    </span>
                </div>
                <div class="staff-actions">
                    ${staffMember.role !== 'super_admin' ? `
                    <button class="btn btn-outline btn-sm reset-password-btn" data-staff-id="${staffMember.id}">
                        <i class="fas fa-key"></i> Reset Password
                    </button>
                    <button class="btn ${staffMember.status === 'suspended' ? 'btn-success' : 'btn-warning'} btn-sm suspend-btn" 
                            data-staff-id="${staffMember.id}">
                        <i class="fas ${staffMember.status === 'suspended' ? 'fa-play' : 'fa-pause'}"></i>
                        ${staffMember.status === 'suspended' ? 'Aktifkan' : 'Suspend'}
                    </button>
                    ` : ''}
                    <button class="btn btn-outline btn-sm view-details-btn" data-staff-id="${staffMember.id}">
                        <i class="fas fa-eye"></i> Detail
                    </button>
                    ${staffMember.role !== 'super_admin' ? `
                    <button class="btn btn-danger btn-sm delete-btn" data-staff-id="${staffMember.id}">
                        <i class="fas fa-trash"></i> Hapus
                    </button>
                    ` : ''}
                </div>
            `;
            
            // Add event listeners to buttons
            this.attachStaffItemEventListeners(staffItem, staffMember.id);
            
            return staffItem;
        }

        attachStaffItemEventListeners(staffItem, staffId) {
            const resetPasswordBtn = staffItem.querySelector('.reset-password-btn');
            const suspendBtn = staffItem.querySelector('.suspend-btn');
            const viewDetailsBtn = staffItem.querySelector('.view-details-btn');
            const deleteBtn = staffItem.querySelector('.delete-btn');
            
            if (resetPasswordBtn) {
                resetPasswordBtn.addEventListener('click', () => this.openResetPasswordModal(staffId));
            }
            
            if (suspendBtn) {
                suspendBtn.addEventListener('click', () => this.toggleSuspend(staffId));
            }
            
            if (viewDetailsBtn) {
                viewDetailsBtn.addEventListener('click', () => this.viewStaffDetails(staffId));
            }
            
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => this.deleteStaff(staffId));
            }
        }

        // Modal Functions
        openAddStaffModal() {
            const modal = document.getElementById('addStaffModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('addStaffForm').reset();
            }
        }

        openResetPasswordModal(staffId) {
            const staff = this.staffData.find(s => s.id === staffId);
            if (staff) {
                document.getElementById('resetStaffId').value = staffId;
                document.getElementById('resetPasswordModal').classList.add('active');
                document.getElementById('resetPasswordForm').reset();
            }
        }

        toggleSuspend(staffId) {
            const staff = this.staffData.find(s => s.id === staffId);
            if (staff && staff.role !== 'super_admin') {
                const newStatus = staff.status === 'suspended' ? 'active' : 'suspended';
                const action = newStatus === 'suspended' ? 'suspend' : 'activate';
                
                this.currentAction = { type: 'suspend', staffId, newStatus };
                
                document.getElementById('suspendModalTitle').textContent = 
                    action === 'suspend' ? 'Suspend Staff' : 'Aktifkan Staff';
                document.getElementById('suspendModalMessage').textContent = 
                    `Apakah Anda yakin ingin ${action === 'suspend' ? 'men-suspend' : 'mengaktifkan'} staff ${staff.name}?`;
                document.getElementById('confirmSuspendBtn').textContent = 
                    action === 'suspend' ? 'Suspend' : 'Aktifkan';
                document.getElementById('confirmSuspendBtn').className = 
                    action === 'suspend' ? 'btn btn-warning' : 'btn btn-success';
                
                document.getElementById('suspendModal').classList.add('active');
            }
        }

        deleteStaff(staffId) {
            const staff = this.staffData.find(s => s.id === staffId);
            
            if (staff && staff.role !== 'super_admin') {
                this.currentAction = { type: 'delete', staffId };
                
                document.getElementById('suspendModalTitle').textContent = 'Hapus Staff';
                document.getElementById('suspendModalMessage').textContent = 
                    `Apakah Anda yakin ingin menghapus staff ${staff.name}? Tindakan ini tidak dapat dibatalkan.`;
                document.getElementById('confirmSuspendBtn').textContent = 'Hapus';
                document.getElementById('confirmSuspendBtn').className = 'btn btn-danger';
                
                document.getElementById('suspendModal').classList.add('active');
            }
        }

        async handleConfirmAction() {
            if (!this.currentAction) return;
            
            const { type, staffId, newStatus } = this.currentAction;
            const staff = this.staffData.find(s => s.id === staffId);
            
            if (!staff) {
                this.showNotification('Staff tidak ditemukan', 'error');
                this.closeModal('suspendModal');
                this.currentAction = null;
                return;
            }
            
            try {
                if (type === 'suspend') {
                    await this.updateStaffStatus(staffId, newStatus);
                } else if (type === 'delete') {
                    await this.deleteStaffFromSystem(staffId);
                }
                
                this.closeModal('suspendModal');
                this.currentAction = null;
                
            } catch (error) {
                console.error(`Error in ${type} action:`, error);
                this.showNotification(`Gagal ${type} staff: ${error.message}`, 'error');
            }
        }

        async updateStaffStatus(staffId, newStatus) {
            const staff = this.staffData.find(s => s.id === staffId);
            
            if (staff) {
                // Update status di array lokal
                staff.status = newStatus;
                
                if (db) {
                    // Update di Firestore dengan format yang benar
                    const firestoreStatus = this.denormalizeStatus(newStatus);
                    await db.collection('users').doc(staffId).update({ 
                        status: firestoreStatus,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    console.log(`Updated user ${staffId} status to ${firestoreStatus} in Firestore`);
                } else {
                    this.saveToLocalStorage();
                }
                
                this.showNotification(
                    `Staff ${staff.name} berhasil ${newStatus === 'suspended' ? 'di-suspend' : 'diaktifkan'}`,
                    'success'
                );
                
                this.renderStaffList();
            }
        }

        // Fungsi untuk memformat last login dengan lebih baik
// Fungsi untuk memformat last login dengan lebih baik
formatLastLogin(lastLogin) {
    if (!lastLogin) return 'Belum pernah login';
    
    try {
        let loginDate;
        
        // Handle berbagai format timestamp
        if (lastLogin.toDate) {
            // Firestore Timestamp
            loginDate = lastLogin.toDate();
        } else if (lastLogin.seconds) {
            // Firebase Timestamp dalam seconds
            loginDate = new Date(lastLogin.seconds * 1000);
        } else if (typeof lastLogin === 'string') {
            // String ISO
            loginDate = new Date(lastLogin);
        } else if (typeof lastLogin === 'object' && lastLogin._seconds) {
            // Firebase Timestamp object
            loginDate = new Date(lastLogin._seconds * 1000);
        } else {
            console.warn("Unknown lastLogin format:", lastLogin);
            return 'Data tidak valid';
        }
        
        // Validasi date
        if (isNaN(loginDate.getTime())) {
            return 'Data tidak valid';
        }
        
        const now = new Date();
        const diffMs = now - loginDate;
        const diffMinutes = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        
        // Format berdasarkan waktu yang lalu
        if (diffMinutes < 1) {
            return 'Baru saja';
        } else if (diffMinutes < 60) {
            return `${diffMinutes} menit yang lalu`;
        } else if (diffHours < 24) {
            return `${diffHours} jam yang lalu`;
        } else if (diffDays === 1) {
            return 'Kemarin ' + loginDate.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        } else if (diffDays < 7) {
            return `${diffDays} hari yang lalu`;
        } else if (diffDays < 30) {
            const weeks = Math.floor(diffDays / 7);
            return `${weeks} minggu yang lalu`;
        } else {
            return loginDate.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    } catch (error) {
        console.error("Error formatting last login:", error);
        return 'Data tidak valid';
    }
}
        async deleteStaffFromSystem(staffId) {
            const staff = this.staffData.find(s => s.id === staffId);
            
            if (db) {
                // Hapus dari Firestore
                await db.collection('users').doc(staffId).delete();
                console.log(`Deleted user ${staffId} from Firestore`);
            }
            
            // Hapus dari data lokal
            this.staffData = this.staffData.filter(s => s.id !== staffId);
            this.saveToLocalStorage();
            
            this.showNotification('Staff berhasil dihapus', 'success');
            this.renderStaffList();
        }

        async handleAddStaff(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('staffName').value,
                email: document.getElementById('staffEmail').value,
                role: document.getElementById('staffRole').value,
                password: document.getElementById('staffPassword').value
            };
            
            // Validate form data
            if (!formData.name || !formData.email || !formData.password) {
                this.showNotification('Semua field harus diisi', 'error');
                return;
            }
            
            if (formData.password.length < 6) {
                this.showNotification('Password minimal 6 karakter', 'error');
                return;
            }
            
            try {
                let newStaff;
                
                // Create user in Firebase Auth
                if (auth) {
                    const userCredential = await auth.createUserWithEmailAndPassword(
                        formData.email, 
                        formData.password
                    );
                    
                    // Prepare data for Firestore
                    const firestoreRole = this.denormalizeRole(formData.role);
                    const firestoreData = {
                        name: formData.name,
                        email: formData.email,
                        role: firestoreRole,
                        status: 'Active',
                        image: 'https://iili.io/KfDh0EN.png',
                        createdate: firebase.firestore.FieldValue.serverTimestamp(),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    newStaff = {
                        id: userCredential.user.uid,
                        name: formData.name,
                        email: formData.email,
                        role: formData.role,
                        status: 'active',
                        avatar: 'https://iili.io/KfDh0EN.png',
                        joinDate: new Date().toISOString().split('T')[0],
                        lastLogin: null,
                        firestoreData: firestoreData
                    };
                    
                    // Save to Firestore
                    await db.collection('users').doc(newStaff.id).set(firestoreData);
                } else {
                    // Fallback to localStorage
                    newStaff = {
                        id: 'staff-' + Date.now(),
                        ...formData,
                        status: 'active',
                        avatar: 'https://iili.io/KfDh0EN.png',
                        joinDate: new Date().toISOString().split('T')[0],
                        lastLogin: null
                    };
                }
                
                this.staffData.push(newStaff);
                this.saveToLocalStorage();
                
                this.closeModal('addStaffModal');
                this.renderStaffList();
                this.showNotification('Staff berhasil ditambahkan', 'success');
                
            } catch (error) {
                console.error('Error adding staff:', error);
                this.showNotification('Gagal menambahkan staff: ' + error.message, 'error');
            }
        }

        async handleResetPassword(e) {
            e.preventDefault();
            
            const staffId = document.getElementById('resetStaffId').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword || !confirmPassword) {
                this.showNotification('Password harus diisi', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                this.showNotification('Password tidak cocok', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                this.showNotification('Password minimal 6 karakter', 'error');
                return;
            }
            
            try {
                const staff = this.staffData.find(s => s.id === staffId);
                
                if (auth) {
                    // Reset password di Firebase Auth
                    this.showNotification('Reset password berhasil (demo mode)', 'success');
                } else {
                    // Update di localStorage (untuk demo)
                    staff.password = newPassword;
                    this.saveToLocalStorage();
                    this.showNotification('Password berhasil direset', 'success');
                }
                
                this.closeModal('resetPasswordModal');
                
            } catch (error) {
                console.error('Error resetting password:', error);
                this.showNotification('Gagal reset password: ' + error.message, 'error');
            }
        }

        viewStaffDetails(staffId) {
            const staff = this.staffData.find(s => s.id === staffId);
            if (staff) {
                this.showStaffDetailsModal(staff);
            }
        }

        showStaffDetailsModal(staff) {
    // Buat modal jika belum ada
    let modal = document.getElementById('staffDetailsModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'staffDetailsModal';
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title"><i class="fas fa-user"></i> Detail Staff</h3>
                    <button class="modal-close" onclick="closeModal('staffDetailsModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="staffDetailsContent">
                    <!-- Content will be filled dynamically -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="closeModal('staffDetailsModal')">Tutup</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Add click outside to close
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                this.closeModal('staffDetailsModal');
            }
        });
    }
    function handleLoginSuccess(user) {
    // Update last login di Firestore
    db.collection('users').doc(user.uid).update({
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        console.log("Last login updated");
    }).catch(error => {
        console.error("Error updating last login:", error);
    });
    
    // Redirect atau lanjutkan proses
    window.location.href = 'dashboard.html';
}
    
    // Isi konten modal
    const content = document.getElementById('staffDetailsContent');
    const lastLogin = this.formatLastLogin(staff.lastLogin);
        
    content.innerHTML = `
        <div class="staff-detail-view">
            <div class="staff-detail-header">
                <img src="${staff.avatar}" alt="${staff.name}" class="staff-detail-avatar" onerror="this.src='https://iili.io/KfDh0EN.png'">
                <div class="staff-detail-info">
                    <h3>${staff.name}</h3>
                    <p>${staff.email}</p>
                    <span class="staff-status status-${staff.status}">
                        <i class="fas ${this.getStatusIcon(staff.status)}"></i>
                        ${this.getStatusText(staff.status)}
                    </span>
                </div>
            </div>
            <div class="staff-detail-meta">
                <div class="detail-item">
                    <label>Role:</label>
                    <span>${this.getRoleText(staff.role)}</span>
                </div>
                <div class="detail-item">
                    <label>Status:</label>
                    <span>${this.getStatusText(staff.status)}</span>
                </div>
                <div class="detail-item">
                    <label>Bergabung:</label>
                    <span>${this.formatDate(staff.joinDate)}</span>
                </div>
                <div class="detail-item">
                    <label>Terakhir Login:</label>
                    <span>${lastLogin}</span>
                </div>
                <div class="detail-item">
                    <label>ID:</label>
                    <span>${staff.id}</span>
                </div>
            </div>
        </div>
    `;
    
    // Tampilkan modal
    modal.classList.add('active');
    
    // Prevent body scroll when modal is open
    document.body.style.overflow = 'hidden';
}

        addDetailModalStyles() {
            if (document.getElementById('staff-detail-styles')) return;
            
            const style = document.createElement('style');
            style.id = 'staff-detail-styles';
            style.textContent = `
                .staff-detail-view {
                    padding: var(--space-md);
                }
                
                .staff-detail-header {
                    display: flex;
                    align-items: center;
                    gap: var(--space-md);
                    margin-bottom: var(--space-lg);
                    padding-bottom: var(--space-md);
                    border-bottom: 1px solid var(--border-color);
                }
                
                .staff-detail-avatar {
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    object-fit: cover;
                }
                
                .staff-detail-info h3 {
                    margin: 0 0 var(--space-xs) 0;
                    font-size: var(--text-lg);
                    color: var(--text-primary);
                }
                
                .staff-detail-info p {
                    margin: 0 0 var(--space-sm) 0;
                    color: var(--text-secondary);
                }
                
                .staff-detail-meta {
                    display: flex;
                    flex-direction: column;
                    gap: var(--space-sm);
                }
                
                .detail-item {
                    display: flex;
                    justify-content: space-between;
                    padding: var(--space-sm) 0;
                    border-bottom: 1px solid var(--border-color-light);
                }
                
                .detail-item label {
                    font-weight: var(--font-medium);
                    color: var(--text-primary);
                }
                
                .detail-item span {
                    color: var(--text-secondary);
                }
            `;
            document.head.appendChild(style);
        }

        closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        filterStaff() {
            this.renderStaffList();
        }

        // Helper functions
        getStatusText(status) {
            const statusMap = {
                'active': 'Aktif',
                'suspended': 'Suspended',
                'pending': 'Pending'
            };
            return statusMap[status] || status;
        }

        getRoleText(role) {
            const roleMap = {
                'super_admin': 'Super Admin',
                'admin': 'Admin',
                'staff': 'Staff',
                'support': 'Support'
            };
            return roleMap[role] || role;
        }

        getStatusIcon(status) {
            const iconMap = {
                'active': 'fa-check-circle',
                'suspended': 'fa-pause-circle',
                'pending': 'fa-clock'
            };
            return iconMap[status] || 'fa-circle';
        }

        formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            } catch (error) {
                console.error("Error formatting date:", error);
                return dateString;
            }
        }

        showLoading(show) {
            if (show) {
                console.log("Loading staff data...");
            }
        }

        showNotification(message, type = 'info') {
            const notificationContainer = document.getElementById('notificationContainer');
            if (!notificationContainer) {
                console.log(`Notification (${type}): ${message}`);
                return;
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'info': 'fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                <span>${message}</span>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.classList.add('hiding');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 500);
                }
            }, 5000);
            
            // Close button
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.classList.add('hiding');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            });
        }
    }

    // ===== INITIALIZATION =====
    let staffManager;

    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM loaded, initializing staff manager...");
        
        staffManager = new StaffAccountManager();
        
        // Global functions
        window.staffManager = staffManager;
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    });

    // Global modal close function
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }
    // Dark Mode Detection and Application
function applyDarkMode() {
    // Check for saved theme preference or preferred color scheme
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.body.classList.add('dark-mode');
    } else {
        document.body.classList.remove('dark-mode');
    }
}

// Apply dark mode when DOM loads
document.addEventListener('DOMContentLoaded', function() {
    applyDarkMode();
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('theme')) {
            applyDarkMode();
        }
    });
});

// Function to toggle dark mode manually
function toggleDarkMode() {
    const isDark = document.body.classList.contains('dark-mode');
    
    if (isDark) {
        document.body.classList.remove('dark-mode');
        localStorage.setItem('theme', 'light');
    } else {
        document.body.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
    }
}
// Fungsi untuk update last login saat user berhasil login
async function updateUserLastLogin(userId) {
    try {
        if (!db) return;
        
        await db.collection('users').doc(userId).update({
            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log(`âœ… Updated last login for user: ${userId}`);
    } catch (error) {
        console.error("âŒ Error updating last login:", error);
    }
}

    </script>
</body>
</html>
