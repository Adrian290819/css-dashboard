<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary Dashboard - CSS Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="stylemobile.css">
    <script src="global-time.js"></script>
    <style>
        /* ========== VARIABEL CSS YANG DIPERLUKAN ========== */
        :root {
            --primary-gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --warning-gradient: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
            --info-gradient: linear-gradient(135deg, #4895ef 0%, #3f37c9 100%);
        }

        /* ========== PERBAIKAN UTAMA UNTUK LAYOUT ========== */
        .main-content {
            padding: var(--space-lg);
            background-color: var(--bg-secondary);
            min-height: 100vh;
        }

        .header {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        

        /* ========== PERBAIKAN STATISTIC CARDS ========== */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .summary-stat-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .summary-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .summary-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .summary-stat-card.performance::before {
            background: var(--success-gradient);
        }

        .summary-stat-card.trend::before {
            background: var(--info-gradient);
        }

        .summary-stat-card.comparison::before {
            background: var(--warning-gradient);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-md);
        }

        .stat-title {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
            margin: 0;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-icon.performance {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .stat-icon.trend {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .stat-icon.comparison {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: var(--font-bold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
            line-height: 1;
        }

        .stat-description {
            font-size: var(--text-xs);
            color: var(--text-secondary);
        }

        /* Tooltip untuk info metrik */
        .info-tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }

        .info-tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-primary);
            color: var(--bg-primary);
            text-align: center;
            border-radius: var(--radius-md);
            padding: var(--space-sm);
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: var(--text-xs);
            font-weight: normal;
        }

        .info-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* ========== PERBAIKAN FILTER SECTION ========== */
        /* ========== PERBAIKAN FILTER SECTION ========== */
.summary-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    padding: var(--space-lg);
    background-color: var(--card-bg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    align-items: end; /* Ratakan elemen ke bawah */
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    min-height: 70px; /* Berikan tinggi minimum yang konsisten */
}

.filter-group label {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--space-xs);
}

.filter-select {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background-color: var(--input-bg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    height: 42px;
    width: 100%; /* Pastikan lebar penuh */
    box-sizing: border-box; /* Include padding dalam perhitungan lebar */
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

/* Perbaikan khusus untuk date range filter */
.date-range-inputs {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    flex-wrap: nowrap;
}

.date-range-inputs span {
    color: var(--text-secondary);
    font-size: var(--text-sm);
    white-space: nowrap;
}

.date-range-inputs input[type="date"] {
    min-width: 120px; /* Berikan lebar minimum untuk input tanggal */
}

/* Perbaikan responsif untuk filter section */
@media (max-width: 1024px) {
    .summary-filters {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .filter-group:last-child {
        grid-column: 1 / -1; /* Rentangkan filter tanggal ke seluruh lebar */
        margin-top: var(--space-sm);
    }
}

@media (max-width: 768px) {
    .summary-filters {
        grid-template-columns: 1fr;
        gap: var(--space-md);
    }
    
    .date-range-inputs {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-xs);
    }
    
    .date-range-inputs span {
        text-align: center;
        margin: var(--space-xs) 0;
    }
}

@media (max-width: 640px) {
    .summary-filters {
        padding: var(--space-md);
    }
    
    .filter-group {
        min-height: 65px; /* Sesuaikan tinggi untuk mobile */
    }
}
        /* ========== PERBAIKAN CHART CONTAINER ========== */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .chart-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .chart-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .chart-content {
            height: 300px;
            position: relative;
        }

        /* ========== PERBAIKAN TABLE ========== */
        .summary-table-section {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: var(--space-xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .summary-table-container {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            margin-bottom: var(--space-lg);
        }

        .summary-table {
            margin: 0;
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 900px;
        }

        .summary-table th {
            padding: var(--space-md) var(--space-lg);
            background: var(--table-header-bg);
            font-weight: var(--font-semibold);
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
            font-size: var(--text-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            text-align: left;
            position: sticky;
            top: 0;
        }

        .summary-table td {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: var(--text-sm);
            vertical-align: middle;
            line-height: 1.5;
        }

        .summary-table tr:last-child td {
            border-bottom: none;
        }

        .summary-table tr:hover {
            background-color: var(--hover-color);
            transition: background-color var(--transition-fast);
        }

        /* Perbaikan untuk Action Buttons */
        .action-buttons {
            display: flex;
            gap: var(--space-xs);
            justify-content: flex-start;
            flex-wrap: nowrap;
        }

        .btn-icon {
            width: 34px;
            height: 34px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--text-sm);
            padding: 0;
            box-shadow: var(--shadow-xs);
        }

        .btn-icon.view {
            background: var(--info-light);
            color: var(--info);
        }

        .btn-icon:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            opacity: 0.9;
        }

        /* ========== PERBAIKAN EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border-color);
            margin: var(--space-lg) 0;
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-md);
        }

        .empty-state h3 {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .empty-state p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-lg);
        }

        /* ========== PERBAIKAN PAGINATION ========== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-md);
            margin-top: var(--space-lg);
            padding: var(--space-md) 0;
        }

        .page-numbers {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: var(--font-medium);
        }

        /* ========== PERBAIKAN MODAL ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(20px);
            transition: transform var(--transition-normal);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast);
        }

        .modal-close:hover {
            background-color: var(--hover-color);
            color: var(--text-primary);
        }

        .modal-body {
            padding: var(--space-lg);
        }

        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
        }

        /* Form input static (readonly) */
        .form-input-static {
            padding: var(--space-sm) 0;
            color: var(--text-primary);
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
            min-height: 20px;
        }

        /* Time tracking styles */
        .time-tracking {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            background: var(--bg-secondary);
            padding: var(--space-md);
            border-radius: var(--radius-md);
        }

        .time-track-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xs) 0;
        }

        .time-track-label {
            font-weight: var(--font-medium);
            color: var(--text-secondary);
        }

        .time-track-value {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
        }

        /* Menu item styles */
        .menu-item {
            background-color: transparent;
            color: var(--text-primary);
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
            border: none;
            text-decoration: none;
        }

        .menu-item:hover {
            background-color: var(--hover-color);
            color: var(--menu-hover-text);
        }

        .menu-item:hover i,
        .menu-item:hover .menu-icon {
            color: var(--menu-hover-text);
        }

        .menu-item.active {
            background: var(--success-gradient);
            color: #fff;
        }

        /* Today indicator */
        .today-indicator {
            display: inline-block;
            padding: 4px 8px;
            background-color: var(--info-light);
            color: var(--info);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
            margin-left: var(--space-sm);
        }

        /* Chart canvas styling */
        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Export button */
        .btn-export {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all var(--transition-fast);
        }

        .btn-export:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Button styles */
        .btn {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all var(--transition-fast);
            border: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* KPI Container */
        .kpi-container {
            margin-bottom: var(--space-lg);
        }

        .kpi-tab-menu {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== RESPONSIVE ADJUSTMENTS ========== */
        @media (max-width: 1024px) {
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: var(--space-md);
            }
            
            .header {
                padding: var(--space-md);
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
            }
            
            .summary-filters {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .summary-table th, 
            .summary-table td {
                padding: var(--space-sm) var(--space-md);
            }
            
            .modal {
                width: 95%;
                margin: var(--space-md);
            }
        }

        @media (max-width: 640px) {
            .summary-table {
                min-width: 100%;
            }
            
            .summary-table th:nth-child(3),
            .summary-table td:nth-child(3),
            .summary-table th:nth-child(6),
            .summary-table td:nth-child(6) {
                display: none;
            }
            
            .pagination {
                flex-direction: column;
                gap: var(--space-sm);
            }
            
            .chart-content {
                height: 250px;
            }
        }

        /* Custom scrollbar for table container */
        .summary-table-container::-webkit-scrollbar {
            height: 8px;
        }

        .summary-table-container::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: var(--radius-full);
        }

        .summary-table-container::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: var(--radius-full);
        }

        .summary-table-container::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }

        /* Hover effects for table rows */
        .summary-table tr {
            transition: background-color var(--transition-fast), transform var(--transition-fast);
        }

        .summary-table tr:hover {
            background-color: var(--hover-color);
            transform: translateX(4px);
        }

        /* Improved focus states for accessibility */
        .btn-icon:focus,
        .filter-select:focus,
        .modal-close:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Style untuk status indicator */
        .status-pending {
            color: #f59e0b;
            background-color: rgba(245, 158, 11, 0.1);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        .status-solved {
            color: #10b981;
            background-color: rgba(16, 185, 129, 0.1);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        .status-maintenance {
            color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--info);
            z-index: 1001;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: #ef4444;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .notification i {
            font-size: 1.25rem;
        }

        .notification.success i {
            color: var(--success);
        }

        .notification.error i {
            color: #ef4444;
        }
         .chart-card.expanded {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw;
            height: 90vh;
            z-index: 1002;
            animation: expandChart 0.3s ease;
        }

        .chart-card.expanded .chart-content {
            height: calc(100% - 80px);
        }

        @keyframes expandChart {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

       /* ========== PERBAIKAN ADDITIONAL STATS ========== */
.additional-stats {
    margin-bottom: var(--space-lg);
}

.additional-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-md);
}

.additional-stat-card {
    background: var(--card-bg);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    text-align: center;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    position: relative;
    overflow: hidden;
}

.additional-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.additional-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary-gradient);
}

.additional-stat-value {
    font-size: 2rem;
    font-weight: var(--font-bold);
    color: var(--primary);
    margin-bottom: var(--space-xs);
    line-height: 1;
}

.additional-stat-label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-weight: var(--font-medium);
}

/* Warna khusus untuk beberapa statistik */
.additional-stat-card:nth-child(2)::before { background: var(--warning-gradient); }
.additional-stat-card:nth-child(3)::before { background: var(--success-gradient); }
.additional-stat-card:nth-child(4)::before { background: var(--info-gradient); }
.additional-stat-card:nth-child(5)::before { background: #f72585; }
.additional-stat-card:nth-child(6)::before { background: #7209b7; }
.additional-stat-card:nth-child(7)::before { background: #3a0ca3; }
.additional-stat-card:nth-child(8)::before { background: #4361ee; }

/* Responsif untuk additional stats */
@media (max-width: 1024px) {
    .additional-stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 640px) {
    .additional-stats-grid {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <!-- Container untuk sidebar yang akan dimuat oleh sidebar-loader.js -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div id="notificationContainer"></div>
            <button class="menu-toggle">
                <i class="fas fa-chart-pie"></i>
            </button>
            <h1><i class="fas fa-chart-pie"></i>Dashboard Overview</h1>
            <div class="header-actions">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search..." id="summarySearch">
                </div>
                
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="user-profile">
                    <img class="profile-img" src="https://iili.io/Fpiva7S.png" alt="Profile">
                    <div class="user-info">
                        <h4>Nama Masing Masing</h4>
                        <p>Customer Service Support</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="kpi-container">
            <!-- Tab Menu -->
            <div class="kpi-tab-menu">
                <!-- Dashboard Overview -->
                <a class="menu-item active" href="summary-dashboard.html">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
                <!-- Summary Dashboard -->
                <a class="menu-item" href="history-activity.html">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>History</span>
                </a>
            </div>
        </div>

        <!-- Summary Stats Cards -->
        <div class="summary-stats">
            <div class="summary-stat-card fade-in" style="animation-delay: 0.1s;">
                <div class="stat-header">
                    <h3 class="stat-title">Weekly Performance
                        <span class="info-tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltip-text">Persentase laporan yang diselesaikan dalam 7 hari terakhir</span>
                        </span>
                    </h3>
                    <div class="stat-icon performance">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-value" id="weeklyPerformance">0%</div>
                <div class="stat-description">
                    <span id="performanceChange" class="positive">
                        <i class="fas fa-arrow-up"></i> 0% from last week
                    </span>
                </div>
            </div>

           <div class="summary-stat-card fade-in" style="animation-delay: 0.2s;">
                <div class="stat-header">
                    <h3 class="stat-title">Resolution Trend
                        <span class="info-tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltip-text">Tingkat resolusi keseluruhan (laporan terselesaikan / total laporan)</span>
                        </span>
                    </h3>
                    <div class="stat-icon trend">
                        <i class="fas fa-chart-line"></i> <!-- Ikon tren -->
                    </div>
                </div>
                <div class="stat-value" id="resolutionRate">0%</div>
                <div class="stat-description">
                    <span id="trendChange" class="positive">
                        <i class="fas fa-arrow-up-right-dots"></i> 0% improvement
                    </span>
                </div>
            </div>

            <div class="summary-stat-card fade-in" style="animation-delay: 0.3s;">
                <div class="stat-header">
                    <h3 class="stat-title">Top Brand by Reports
                        <span class="info-tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltip-text">Brand dengan jumlah laporan terbanyak</span>
                        </span>
                    </h3>
                    <div class="stat-icon comparison">
                        <i class="fas fa-crown"></i>
                    </div>
                </div>
                <div class="stat-value" id="topBrand">-</div>
                <div class="stat-description">
                    Most reports this month
                </div>
            </div>
        </div>

<div class="additional-stats fade-in" style="animation-delay: 0.4s;">
    <div class="additional-stats-grid">
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="totalReports">0</div>
            <div class="additional-stat-label">Total Reports</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="solvedReports">0</div>
            <div class="additional-stat-label">Solved Reports</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="pendingReports">0</div>
            <div class="additional-stat-label">Pending Reports</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="maintenanceReports">0</div>
            <div class="additional-stat-label">Maintenance Reports</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="solvedMaintenance">0</div>
            <div class="additional-stat-label">Solved Maintenance</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="newGameReleases">0</div>
            <div class="additional-stat-label">New Game Releases</div>
        </div>
        <div class="additional-stat-card">
            <div class="additional-stat-value" id="newfeatureReleases">0</div>
            <div class="additional-stat-label">New Feature Releases</div>
        </div>
    </div>
</div>
<!-- Filters Section -->
<div class="summary-filters fade-in" style="animation-delay: 0.5s;">
    <!-- Filter Category -->
    <div class="filter-group">
        <label for="categoryFilter">Category</label>
        <select class="filter-select" id="categoryFilter">
            <option value="all">All Categories</option>
            <option value="Pending">Pending Report</option>
            <option value="Solved">Solved Report</option>
            <option value="Maintenance">Pending Maintenance</option>
            <option value="Maintenance Solved">Solved Maintenance</option>
            <option value="Releases New Feature">Releases New Feature</option>
            <option value="Releases New Game">Releases New Game</option>
        </select>
    </div>

    <!-- Filter Brand -->
    <div class="filter-group">
        <label for="brandFilter">Brand</label>
        <select class="filter-select" id="brandFilter">
            <option value="all">All Brands</option>
            <option value="CINTAWIN88 (D-GAMING)">CINTAWIN88 (D-GAMING)</option>
            <option value="CERIASLOT99 (D-GAMING)">CERIASLOT99 (D-GAMING)</option>
            <option value="RAJASCATTER88 (D-GAMING)">RAJASCATTER88 (D-GAMING)</option>
            <option value="MAHJONGJP88 (D-GAMING)">MAHJONGJP88 (D-GAMING)</option>
            <option value="NAGAHOKI88 (D-GAMING)">NAGAHOKI88 (D-GAMING)</option>
            <option value="SPACEMAN88 (D-GAMING)">SPACEMAN88 (D-GAMING)</option>
            <option value="RAJAPANEN (D-GAMING)">RAJAPANEN (D-GAMING)</option>
            <option value="BROTO88 (D-GAMING)">BROTO88 (D-GAMING)</option>
            <option value="MEDUSA88 (GACHA)">MEDUSA88 (GACHA)</option>
            <option value="ATHENA168 (GACHA)">ATHENA168 (GACHA)</option>
            <option value="ARES GACOR (GACHA)">ARES GACOR (GACHA)</option>
            <option value="RAJA MAHJONG (GACHA)">RAJA MAHJONG (GACHA)</option>
            <option value="OLYMPUS1000 (GACHA)">OLYMPUS1000 (GACHA)</option>
            <option value="CLICKBET (GACHA)">CLICKBET (GACHA)</option>
            <option value="GACHA99 (GACHA)">GACHA99 (GACHA)</option>
            <option value="UJANGBET (BREM)">UJANGBET (BREM)</option>
            <option value="EPISODEBET (BREM)">EPISODEBET (BREM)</option>
            <option value="FOKUSBET88 (89ENGINE)">FOKUSBET88 (89ENGINE)</option>
            <option value="RAJAKING88 (89ENGINE)">RAJAKING88 (89ENGINE)</option>
            <option value="RAJANAGA99 (89ENGINE)">RAJANAGA99 (89ENGINE)</option>
            <option value="JOIN999 (LUXION)">JOIN999 (LUXION)</option>
        </select>
    </div>

    <!-- Filter Date Range -->
    <div class="filter-group">
        <label for="startDate">Date Range</label>
        <div class="date-range-inputs">
            <input type="date" class="filter-select" id="startDate" aria-label="Start date">
            <span>to</span>
            <input type="date" class="filter-select" id="endDate" aria-label="End date">
        </div>
    </div>
</div>
        <!-- Charts Section -->
        <div class="charts-container">
            <div class="chart-card fade-in" style="animation-delay: 0.6s;">
                <div class="chart-header">
                    <h3 class="chart-title">Reports by Status</h3>
                    <div class="chart-actions">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="statusChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="chart-card fade-in" style="animation-delay: 0.7s;">
                <div class="chart-header">
                    <h3 class="chart-title">Weekly Resolution Trend</h3>
                    <div class="chart-actions">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="trendChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="chart-card fade-in" style="animation-delay: 0.8s;">
                <div class="chart-header">
                    <h3 class="chart-title">Reports by Category</h3>
                    <div class="chart-actions">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="categoryChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="chart-card fade-in" style="animation-delay: 0.9s;">
                <div class="chart-header">
                    <h3 class="chart-title">Reports by Brand</h3>
                    <div class="chart-actions">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="brandChart" class="chart-canvas"></canvas>
                </div>
            </div>
 <div class="chart-card fade-in" style="animation-delay: 1.0s;">
        <div class="chart-header">
            <h3 class="chart-title">New Game Releases</h3>
            <div class="chart-actions">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        <div class="chart-content">
            <canvas id="gameReleasesChart" class="chart-canvas"></canvas>
        </div>
    </div>
    
    <!-- NEW: Chart untuk New Feature Releases -->
    <div class="chart-card fade-in" style="animation-delay: 1.1s;">
        <div class="chart-header">
            <h3 class="chart-title">New Feature Releases</h3>
            <div class="chart-actions">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        <div class="chart-content">
            <canvas id="featureReleasesChart" class="chart-canvas"></canvas>
        </div>
    </div>
</div>

    <script src="sidebar-loader.js"></script>
    <script src="user-profile.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

    <script>
    // ========== KONFIGURASI FIREBASE ==========
    const firebaseConfig = {
        apiKey: "AIzaSyDUZka4FZyLi_cv6X_5D4zeRsfkpqOlBpY",
        authDomain: "dashboard-css.firebaseapp.com",
        databaseURL: "https://dashboard-css-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "dashboard-css",
        storageBucket: "dashboard-css.appspot.com",
        messagingSenderId: "771131792881",
        appId: "1:771131792881:web:ad634424225bd7de847850",
        measurementId: "G-3CYBC5B101"
    };

    // Inisialisasi Firebase
    try {
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase initialized successfully");
    } catch (error) {
        console.error("Firebase initialization error:", error);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    // ========== VARIABEL GLOBAL ==========
    let allReportsData = [];
    let reportsListener = null;
    let dateRangeFilter = 30; // Default: 30 hari
    let newGamesListener = null;
    let currentPage = 1;
    const itemsPerPage = 10;
    let totalPages = 1;
    let currentSearchTerm = '';

    // ========== FUNGSI UTAMA ==========

    // Fungsi untuk mendapatkan tanggal dengan offset hari
    function getDateWithOffset(daysOffset) {
        const now = new Date();
        // Convert to Indonesia timezone (UTC+7)
        const offset = 7; // UTC+7 for Indonesia Western Time
        const localTime = now.getTime();
        const localOffset = now.getTimezoneOffset() * 60000;
        const utc = localTime + localOffset;
        const indonesiaTime = new Date(utc + (3600000 * offset));
        
        // Subtract days offset
        indonesiaTime.setDate(indonesiaTime.getDate() - daysOffset);
        
        // Set to start of day (00:00:00)
        indonesiaTime.setHours(0, 0, 0, 0);
        
        // Convert back to UTC for Firestore query
        const utcTime = new Date(indonesiaTime.getTime() - (3600000 * offset));
        return utcTime;
    }

    // Fungsi untuk setup listener data laporan
    function setupReportsListener() {
        console.log("Setting up reports listener for date range:", dateRangeFilter);
        
        // Hentikan listener sebelumnya jika ada
        if (reportsListener) {
            reportsListener();
        }
        
        const startDate = getDateWithOffset(dateRangeFilter);
        const endDate = new Date(); // Sekarang
        
        console.log("Query range (UTC):", startDate, "to", endDate);
        
        // Setup listener untuk semua jenis data
        const pendingQuery = db.collection('pendingReports')
            .where('dateCreated', '>=', startDate)
            .where('dateCreated', '<=', endDate);
        
        const solvedQuery = db.collection('solvedReports')
            .where('dateCreated', '>=', startDate)
            .where('dateCreated', '<=', endDate);
        
        const maintenanceQuery = db.collection('maintenanceReports')
            .where('dateCreated', '>=', startDate)
            .where('dateCreated', '<=', endDate);
        
        const solvedMaintenanceQuery = db.collection('solvedMaintenance')
            .where('dateCompleted', '>=', startDate)
            .where('dateCompleted', '<=', endDate);
        
        // Simpan unsubscribe functions
        const unsubscribeFunctions = [];
        
        // Listener untuk pending reports
        const pendingUnsubscribe = pendingQuery.onSnapshot(
            (snapshot) => {
                console.log(`[PENDING] Snapshot received: ${snapshot.docs.length} documents`);
                processPendingSnapshot(snapshot);
                updateCombinedReports();
            },
            (error) => {
                console.error("[PENDING] Error listening to pending reports:", error);
                showNotification('Gagal memuat data pending reports', 'error');
            }
        );
        unsubscribeFunctions.push(pendingUnsubscribe);

   // Listener untuk solved reports
const solvedUnsubscribe = solvedQuery.onSnapshot(
    (snapshot) => {
        console.log(`[SOLVED] Snapshot received: ${snapshot.docs.length} documents`);
        // Mengambil jumlah dokumen dari snapshot dan menampilkannya di elemen HTML
        document.getElementById('solvedReports').textContent = snapshot.docs.length;
        processSolvedSnapshot(snapshot);
        updateCombinedReports();
    },
    (error) => {
        console.error("[SOLVED] Error listening to solved reports:", error);
        showNotification('Gagal memuat data solved reports', 'error');
    }
);
unsubscribeFunctions.push(solvedUnsubscribe);
        
        // Listener untuk maintenance reports
        const maintenanceUnsubscribe = maintenanceQuery.onSnapshot(
            (snapshot) => {
                console.log("[MAINTENANCE] Snapshot received:", snapshot.docs.length, "documents");
                processMaintenanceSnapshot(snapshot);
                updateCombinedReports();
            },
            (error) => {
                console.error("[MAINTENANCE] Error listening to maintenance reports:", error);
                showNotification('Gagal memuat data maintenance', 'error');
            }
        );
        unsubscribeFunctions.push(maintenanceUnsubscribe);
        
        // Listener untuk solved maintenance
        const solvedMaintenanceUnsubscribe = solvedMaintenanceQuery.onSnapshot(
            (snapshot) => {
                console.log("[SOLVED MAINTENANCE] Snapshot received:", snapshot.docs.length, "documents");
                processSolvedMaintenanceSnapshot(snapshot);
                updateCombinedReports();
            },
            (error) => {
                console.error("[SOLVED MAINTENANCE] Error listening to solved maintenance:", error);
                showNotification('Gagal memuat data solved maintenance', 'error');
            }
        );
        unsubscribeFunctions.push(solvedMaintenanceUnsubscribe);
        
        // Kembalikan fungsi untuk unsubscribe semua listener
        reportsListener = () => {
            unsubscribeFunctions.forEach(unsubscribe => unsubscribe());
            console.log("Reports listeners removed");
        };
    }

    // Proses snapshot pending reports
    function processPendingSnapshot(snapshot) {
        const pendingReports = snapshot.docs.map(doc => {
            const data = doc.data();
            return { 
                id: doc.id, 
                ...data,
                status: 'Pending',
                collection: 'pendingReports',
                date: data.dateCreated,
                isSolved: false
            };
        });
        
        // Simpan di storage terpisah
        window.pendingReportsCache = pendingReports;
        console.log("Pending reports cached:", pendingReports.length);
    }

    // Proses snapshot solved reports
    function processSolvedSnapshot(snapshot) {
        const solvedReports = snapshot.docs.map(doc => {
            const data = doc.data();
            return { 
                id: doc.id, 
                ...data,
                status: 'Solved',
                collection: 'solvedReports',
                date: data.dateCreated,
                isSolved: true,
                resolutionTime: calculateResolutionTime(data.dateCreated, data.dateSolved)
            };
        });
        
        // Simpan di storage terpisah
        window.solvedReportsCache = solvedReports;
        console.log("Solved reports cached:", solvedReports.length);
    }

    // Proses snapshot maintenance reports
    function processMaintenanceSnapshot(snapshot) {
        const maintenanceReports = snapshot.docs.map(doc => {
            const data = doc.data();
            return { 
                id: doc.id, 
                ...data,
                status: 'Maintenance',
                collection: 'maintenanceReports',
                date: data.dateCreated,
                isSolved: false,
                category: data.category || 'Report Maintenance'
            };
        });
        
        // Simpan di storage terpisah
        window.maintenanceReportsCache = maintenanceReports;
        console.log("Maintenance reports cached:", maintenanceReports.length);
    }

    // Proses snapshot solved maintenance
    function processSolvedMaintenanceSnapshot(snapshot) {
        const solvedMaintenanceReports = snapshot.docs.map(doc => {
            const data = doc.data();
            return { 
                id: doc.id, 
                ...data,
                status: 'Maintenance Solved',
                collection: 'solvedMaintenance',
                date: data.dateCompleted,
                isSolved: true,
                category: data.category || 'Report Maintenance',
                resolutionTime: calculateResolutionTime(data.dateCreated, data.dateCompleted)
            };
        });
        
        // Simpan di storage terpisah
        window.solvedMaintenanceCache = solvedMaintenanceReports;
        console.log("Solved maintenance cached:", solvedMaintenanceReports.length);
    }

    // Hitung waktu resolusi dalam menit
    function calculateResolutionTime(startDate, endDate) {
        if (!startDate || !endDate) return 0;
        
        try {
            const start = startDate.toDate ? startDate.toDate() : new Date(startDate);
            const end = endDate.toDate ? endDate.toDate() : new Date(endDate);
            
            const diffMs = end - start;
            return Math.round(diffMs / (1000 * 60)); // Convert to minutes
        } catch (error) {
            console.error("Error calculating resolution time:", error);
            return 0;
        }
    }

    // Gabungkan dan update semua laporan
    function updateCombinedReports() {
        const pending = window.pendingReportsCache || [];
        const solved = window.solvedReportsCache || [];
        const maintenance = window.maintenanceReportsCache || [];
        const solvedMaintenance = window.solvedMaintenanceCache || [];
        
        console.log("Combining reports - Pending:", pending.length, "Solved:", solved.length, 
                    "Maintenance:", maintenance.length, "Solved Maintenance:", solvedMaintenance.length);
        
        // Gabungkan semua laporan
        allReportsData = [...pending, ...solved, ...maintenance, ...solvedMaintenance];
            
        console.log("Total reports after combining:", allReportsData.length);
        
        // Perbarui UI
        updateDashboardStats(allReportsData);
        updateCharts(allReportsData);
        updateSummaryTable(allReportsData);
    }

    // ========== FUNGSI STATISTIK & UI UPDATE ==========

    // Fungsi untuk menghitung statistik dashboard
    function calculateRealStats(reports) {
        // Hitung total reports
        const totalReports = reports.length;
        
        // Hitung solved reports
        const solvedReports = reports.filter(report => report.isSolved).length;
        
        // Hitung resolution rate
        const resolutionRate = totalReports > 0 ? Math.round((solvedReports / totalReports) * 100) : 0;
        
        // Hitung rata-rata resolution time untuk reports yang sudah solved
        let totalResolutionTime = 0;
        let countWithResolutionTime = 0;
        
        reports.forEach(report => {
            if (report.isSolved && report.resolutionTime) {
                totalResolutionTime += report.resolutionTime;
                countWithResolutionTime++;
            }
        });
        
        // Hitung reports per brand
        const brandCounts = {};
        reports.forEach(report => {
            if (report.brand) {
                brandCounts[report.brand] = (brandCounts[report.brand] || 0) + 1;
            }
        });
        
        // Temukan brand dengan laporan terbanyak
        let topBrand = { name: "None", count: 0 };
        for (const brand in brandCounts) {
            if (brandCounts[brand] > topBrand.count) {
                topBrand = { name: brand, count: brandCounts[brand] };
            }
        }
        
        // Hitung reports per kategori
        const categoryCounts = {};
        reports.forEach(report => {
            if (report.category) {
                categoryCounts[report.category] = (categoryCounts[report.category] || 0) + 1;
            }
        });
        
        // Hitung reports per status
        const statusCounts = {
            'Pending': reports.filter(report => report.status === 'Pending').length,
            'Solved': reports.filter(report => report.status === 'Solved').length,
            'Maintenance': reports.filter(report => report.status === 'Maintenance').length,
            'Maintenance Solved': reports.filter(report => report.status === 'Maintenance Solved').length
        };
        
        return {
            totalReports,
            solvedCount: solvedReports,
            pendingCount: statusCounts.Pending,
            maintenanceCount: statusCounts.Maintenance,
            solvedMaintenanceCount: statusCounts['Maintenance Solved'],
            resolutionRate,
            topBrand,
            categoryCounts,
            statusCounts,
            brandCounts
        };
    }

    // Fungsi untuk memperbarui statistik dashboard
    function updateDashboardStats(reports) {
        const stats = calculateRealStats(reports);
        
        // Update semua statistik utama
        document.getElementById('weeklyPerformance').textContent = `${stats.resolutionRate}%`;
        document.getElementById('resolutionRate').textContent = `${stats.resolutionRate}%`;
        document.getElementById('topBrand').textContent = stats.topBrand.name;
        
        // Update additional stats - SEMUA ELEMEN
        document.getElementById('totalReports').textContent = stats.totalReports;
        document.getElementById('solvedReports').textContent = stats.solvedCount;
        document.getElementById('pendingReports').textContent = stats.pendingCount;
        document.getElementById('maintenanceReports').textContent = stats.maintenanceCount;
        document.getElementById('solvedMaintenance').textContent = stats.solvedMaintenanceCount;
        
        // Update new game releases (ambil dari data game jika tersedia)
        const newGameReleases = window.newGamesData ? window.newGamesData.length : 0;
        document.getElementById('newGameReleases').textContent = newGameReleases;
        
        // Update trend indicators dengan data yang lebih realistis
        const performanceChange = calculatePerformanceChange(reports);
        document.getElementById('performanceChange').innerHTML = 
            performanceChange >= 0 ? 
            `<i class="fas fa-arrow-up"></i> ${performanceChange}% from last week` :
            `<i class="fas fa-arrow-down"></i> ${Math.abs(performanceChange)}% from last week`;
        
        const trendChange = calculateTrendChange(reports);
        document.getElementById('trendChange').innerHTML = 
            trendChange >= 0 ? 
            `<i class="fas fa-arrow-up"></i> ${trendChange}% improvement` :
            `<i class="fas fa-arrow-down"></i> ${Math.abs(trendChange)}% decline`;
    }

    // Fungsi bantu untuk menghitung perubahan performa
    function calculatePerformanceChange(reports) {
        // Hitung performa minggu ini
        const thisWeek = getDateWithOffset(7);
        const thisWeekReports = reports.filter(report => {
            const reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
            return reportDate >= thisWeek;
        });
        
        const thisWeekSolved = thisWeekReports.filter(report => report.isSolved).length;
        const thisWeekRate = thisWeekReports.length > 0 ? 
            Math.round((thisWeekSolved / thisWeekReports.length) * 100) : 0;
        
        // Hitung performa minggu lalu
        const lastWeekStart = getDateWithOffset(14);
        const lastWeekEnd = getDateWithOffset(7);
        const lastWeekReports = reports.filter(report => {
            const reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
            return reportDate >= lastWeekStart && reportDate < lastWeekEnd;
        });
        
        const lastWeekSolved = lastWeekReports.filter(report => report.isSolved).length;
        const lastWeekRate = lastWeekReports.length > 0 ? 
            Math.round((lastWeekSolved / lastWeekReports.length) * 100) : 0;
        
        // Hitung perubahan
        return lastWeekRate > 0 ? thisWeekRate - lastWeekRate : 0;
    }

    // Fungsi bantu untuk menghitung perubahan tren
    function calculateTrendChange(reports) {
        // Hitung resolusi rate bulan ini
        const thisMonth = getDateWithOffset(30);
        const thisMonthReports = reports.filter(report => {
            const reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
            return reportDate >= thisMonth;
        });
        
        const thisMonthSolved = thisMonthReports.filter(report => report.isSolved).length;
        const thisMonthRate = thisMonthReports.length > 0 ? 
            Math.round((thisMonthSolved / thisMonthReports.length) * 100) : 0;
        
        // Hitung resolusi rate bulan lalu
        const lastMonthStart = getDateWithOffset(60);
        const lastMonthEnd = getDateWithOffset(30);
        const lastMonthReports = reports.filter(report => {
            const reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
            return reportDate >= lastMonthStart && reportDate < lastMonthEnd;
        });
        
        const lastMonthSolved = lastMonthReports.filter(report => report.isSolved).length;
        const lastMonthRate = lastMonthReports.length > 0 ? 
            Math.round((lastMonthSolved / lastMonthReports.length) * 100) : 0;
        
        // Hitung perubahan
        return lastMonthRate > 0 ? thisMonthRate - lastMonthRate : 0;
    }

    // Fungsi untuk memperbarui chart
    function updateCharts(reports) {
        const stats = calculateRealStats(reports);
        
        // Update Status Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        if (window.statusChartInstance) {
            window.statusChartInstance.destroy();
        }
        window.statusChartInstance = new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Solved', 'Pending', 'Maintenance', 'Maintenance Solved'],
                datasets: [{
                    data: [
                        stats.statusCounts.Solved, 
                        stats.statusCounts.Pending,
                        stats.statusCounts.Maintenance,
                        stats.statusCounts['Maintenance Solved']
                    ],
                    backgroundColor: ['#4cc9f0', '#f72585', '#4895ef', '#3a0ca3'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        // Update Trend Chart (data mingguan)
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        if (window.trendChartInstance) {
            window.trendChartInstance.destroy();
        }
        
        // Generate weekly resolution data based on actual reports
        const weeks = getLast4Weeks();
        const resolutionData = calculateWeeklyResolutionData(reports, weeks);
        
        window.trendChartInstance = new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: weeks.map(w => w.label),
                datasets: [{
                    label: 'Resolution Rate',
                    data: resolutionData,
                    borderColor: '#4361ee',
                    backgroundColor: 'rgba(67, 97, 238, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: Math.max(0, Math.min(...resolutionData) - 10),
                        max: Math.min(100, Math.max(...resolutionData) + 10)
                    }
                }
            }
        });
        
        // Update Category Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        if (window.categoryChartInstance) {
            window.categoryChartInstance.destroy();
        }
        
        // Siapkan data untuk chart kategori
        const categoryLabels = Object.keys(stats.categoryCounts);
        const categoryData = Object.values(stats.categoryCounts);
        
        window.categoryChartInstance = new Chart(categoryCtx, {
            type: 'bar',
            data: {
                labels: categoryLabels,
                datasets: [{
                    label: 'Reports by Category',
                    data: categoryData,
                    backgroundColor: '#4895ef',
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Update Brand Chart
        const brandCtx = document.getElementById('brandChart').getContext('2d');
        if (window.brandChartInstance) {
            window.brandChartInstance.destroy();
        }
        
        // Siapkan data untuk chart brand (ambil top 10 brand)
        const brandEntries = Object.entries(stats.brandCounts);
        brandEntries.sort((a, b) => b[1] - a[1]);
        const topBrands = brandEntries.slice(0, 10);
        const brandLabels = topBrands.map(brand => brand[0]);
        const brandData = topBrands.map(brand => brand[1]);
        
        window.brandChartInstance = new Chart(brandCtx, {
            type: 'bar',
            data: {
                labels: brandLabels,
                datasets: [{
                    label: 'Reports by Brand',
                    data: brandData,
                    backgroundColor: '#f72585',
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Fungsi untuk mendapatkan label 4 minggu terakhir
    function getLast4Weeks() {
        const weeks = [];
        const now = new Date();
        
        for (let i = 3; i >= 0; i--) {
            const startDate = new Date(now);
            startDate.setDate(now.getDate() - (i * 7));
            
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            
            const weekLabel = `Minggu ${4-i}`;
            weeks.push({
                label: weekLabel,
                start: startDate,
                end: endDate
            });
        }
        
        return weeks;
    }

    // Fungsi untuk menghitung data resolusi mingguan
    function calculateWeeklyResolutionData(reports, weeks) {
        return weeks.map(week => {
            const weekReports = reports.filter(report => {
                const reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
                return reportDate >= week.start && reportDate <= week.end;
            });
            
            if (weekReports.length === 0) return 0;
            
            const solvedCount = weekReports.filter(report => report.isSolved).length;
            return Math.round((solvedCount / weekReports.length) * 100);
        });
    }

    // ========== FUNGSI FILTER ==========

function applyFilters(reports) {
    const categoryFilter = document.getElementById('categoryFilter').value;
    const brandFilter = document.getElementById('brandFilter').value;
    
    let filteredReports = reports;
    
    // Filter berdasarkan kategori
    if (categoryFilter !== 'all') {
        filteredReports = filteredReports.filter(report => {
            // Handle berbagai format kategori yang mungkin
            const reportCategory = report.category || report.status || '';
            
            // Mapping untuk kategori yang spesifik
            if (categoryFilter === 'Pending' && report.status === 'Pending') return true;
            if (categoryFilter === 'Solved' && report.status === 'Solved') return true;
            if (categoryFilter === 'Maintenance' && report.status === 'Maintenance') return true;
            if (categoryFilter === 'Maintenance Solved' && report.status === 'Maintenance Solved') return true;
            if (categoryFilter === 'Releases New Feature' && report.category === 'Releases New Feature') return true;
            if (categoryFilter === 'Releases New Game' && report.category === 'Releases New Game') return true;
            
            return reportCategory === categoryFilter;
        });
    }
    
    // Filter berdasarkan brand
    if (brandFilter !== 'all') {
        filteredReports = filteredReports.filter(report => {
            const reportBrand = report.brand || '';
            return reportBrand === brandFilter;
        });
    }
    
    console.log("After filtering - Category:", categoryFilter, "Brand:", brandFilter, "Results:", filteredReports.length);
    return filteredReports;
}
function updateChartsWithFilteredData(reports) {
    const filteredReports = applyFilters(reports);
    updateCharts(filteredReports);
}
    // ========== FUNGSI PAGINATION ==========

    function setupPagination(reports) {
        const filteredReports = applyFilters(reports);
        const searchedReports = filterDataBySearch(filteredReports, currentSearchTerm);
        totalPages = Math.ceil(searchedReports.length / itemsPerPage);
        
        // Update teks halaman
        const pageNumbersElement = document.querySelector('.page-numbers');
        if (pageNumbersElement) {
            pageNumbersElement.textContent = `Page ${currentPage} of ${totalPages}`;
        }
        
        // Enable/disable tombol berdasarkan halaman saat ini
        const prevButton = document.getElementById('prevPage');
        const nextButton = document.getElementById('nextPage');
        
        if (prevButton) prevButton.disabled = currentPage === 1;
        if (nextButton) nextButton.disabled = currentPage === totalPages;
        
        // Tampilkan data untuk halaman saat ini
        displayPageData(searchedReports);
    }

    function displayPageData(reports) {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = reports.slice(startIndex, endIndex);
        
        // Gunakan pageData untuk menampilkan data di tabel
        renderTableData(pageData);
    }

    function renderTableData(reports) {
        const tableBody = document.getElementById('summaryTableBody');
        const emptyState = document.getElementById('noSummaryData');
        
        // Kosongkan tabel
        if (tableBody) tableBody.innerHTML = '';
        
        // Tampilkan empty state jika tidak ada data
        if (reports.length === 0) {
            if (emptyState) emptyState.style.display = 'block';
            return;
        }
        
        // Sembunyikan empty state
        if (emptyState) emptyState.style.display = 'none';
        
        // Tambahkan data ke tabel
        reports.forEach(report => {
            const row = document.createElement('tr');
            
            // Format tanggal
            let reportDate;
            try {
                reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
                // Convert to Indonesia timezone (UTC+7)
                const offset = 7;
                const localTime = reportDate.getTime();
                const localOffset = reportDate.getTimezoneOffset() * 60000;
                const utc = localTime + localOffset;
                const indonesiaTime = new Date(utc + (3600000 * offset));
                
                reportDate = indonesiaTime.toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (error) {
                console.error("Error formatting date:", error, report.date);
                reportDate = 'N/A';
            }
            
            // Format resolution time
            let resolutionTime = 'N/A';
            if (report.resolutionTime) {
                const hours = Math.floor(report.resolutionTime / 60);
                const minutes = report.resolutionTime % 60;
                resolutionTime = `${hours}h ${minutes}m`;
            }
            
            // Tentukan status dan class-nya
            let statusClass = 'status-pending';
            let statusText = report.status || 'Pending';
            
            if (statusText === 'Solved' || report.isSolved) {
                statusClass = 'status-solved';
            } else if (statusText.includes('Maintenance')) {
                statusClass = 'status-maintenance';
            }
            
            row.innerHTML = `
                <td>${reportDate}</td>
                <td>${report.id || 'N/A'}</td>
                <td>${report.category || 'N/A'}</td>
                <td><span class="${statusClass}">${statusText}</span></td>
                <td>${report.brand || 'N/A'}</td>
                <td>${resolutionTime}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-icon view" title="View Details" onclick="viewReportDetails('${report.id}', '${report.collection}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </td>
            `;
            
            if (tableBody) tableBody.appendChild(row);
        });
    }

    function goToPage(page) {
        if (page >= 1 && page <= totalPages) {
            currentPage = page;
            setupPagination(allReportsData);
        }
    }

    // ========== FUNGSI PENCARIAN ==========

    function filterDataBySearch(reports, searchTerm) {
        if (!searchTerm || searchTerm.trim() === '') {
            return reports; // Kembalikan semua data jika pencarian kosong
        }
        
        const term = searchTerm.toLowerCase().trim();
        
        return reports.filter(report => {
            // Cari di semua field yang relevan
            return (
                (report.id && report.id.toLowerCase().includes(term)) ||
                (report.category && report.category.toLowerCase().includes(term)) ||
                (report.status && report.status.toLowerCase().includes(term)) ||
                (report.brand && report.brand.toLowerCase().includes(term)) ||
                (report.description && report.description.toLowerCase().includes(term))
            );
        });
    }

    function handleSearch() {
        const searchInput = document.getElementById('summarySearch');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value;
        currentSearchTerm = searchTerm;
        
        // Reset ke halaman pertama saat pencarian
        currentPage = 1;
        
        // Filter data berdasarkan pencarian
        const filteredData = filterDataBySearch(allReportsData, searchTerm);
        
        // Perbarui UI dengan data yang sudah difilter
        updateDashboardStats(filteredData);
        updateCharts(filteredData);
        updateSummaryTable(filteredData);
        
        // Tampilkan notifikasi jika tidak ada hasil
        if (searchTerm && filteredData.length === 0) {
            showNotification('No results found for: ' + searchTerm, 'info');
        }
    }

    // ========== FUNGSI UNTUK NEW GAMES ==========
    
    function setupNewGamesListener() {
        console.log("Setting up new games listener...");
        
        // Hentikan listener sebelumnya jika ada
        if (newGamesListener) {
            newGamesListener();
        }
        
        try {
            // Setup listener untuk koleksi newGame
            newGamesListener = db.collection('newGame')
                .onSnapshot(snapshot => {
                    let newGamesData = [];
                    
                    snapshot.forEach(doc => {
                        try {
                            const gameData = doc.data();
                            gameData.id = doc.id;
                            newGamesData.push(gameData);
                        } catch (e) {
                            console.error("Error processing game document:", e);
                        }
                    });
                    
                    console.log(`Successfully fetched ${newGamesData.length} games from releases-newgame`);
                    
                    // Memproses data game yang diambil
                    processNewGamesData(newGamesData);
                    
                }, error => {
                    console.error("Error in new games listener:", error);
                    showNotification('Gagal memuat data game baru', 'error');
                });
                
            return newGamesListener;
        } catch (error) {
            console.error("Error setting up new games listener:", error);
            showNotification('Error setting up game listener', 'error');
            return () => {}; // Return empty unsubscribe function
        }
    }

    function processNewGamesData(gamesData) {
        // Hitung statistik dari data game
        const totalGames = gamesData.length;
        const upcomingGames = gamesData.filter(game => 
            game.status && game.status.toLowerCase() === 'upcoming').length;
        
        // Filter game populer (rating >= 4.5)
        const popularGames = gamesData.filter(game => {
            // Pastikan rating ada dan berupa angka
            const rating = parseFloat(game.rating);
            return !isNaN(rating) && rating >= 4.5;
        }).length;
        
        // Hitung jumlah kategori unik
        const uniqueCategories = new Set();
        gamesData.forEach(game => {
            if (game.category) {
                uniqueCategories.add(game.category);
            }
        });
        const categoryCount = uniqueCategories.size;
        
        // Update UI dengan data yang diperoleh
        updateNewGamesUI(totalGames, upcomingGames, popularGames, categoryCount);
        
        // Simpan data untuk penggunaan lain jika diperlukan
        window.newGamesData = gamesData;
    }

    function updateNewGamesUI(total, upcoming, popular, categories) {
        // Update elemen UI dengan data yang diperoleh
        const totalElement = document.getElementById('totalGames');
        const upcomingElement = document.getElementById('upcomingGames');
        const popularElement = document.getElementById('popularGames');
        const categoriesElement = document.getElementById('gameCategories');
        
        if (totalElement) totalElement.textContent = total;
        if (upcomingElement) upcomingElement.textContent = upcoming;
        if (popularElement) popularElement.textContent = popular;
        if (categoriesElement) categoriesElement.textContent = categories;
        
        console.log(`Updated games UI - Total: ${total}, Upcoming: ${upcoming}, Popular: ${popular}, Categories: ${categories}`);
    }

    // ========== FUNGSI UTILITAS ==========

    // Fungsi untuk menampilkan notifikasi
    function showNotification(message, type = 'info') {
        const notificationContainer = document.getElementById('notificationContainer');
        if (!notificationContainer) return;

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icon = type === 'success' ? 'fa-check-circle' : 
                    type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
        
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            </div>
        `;

        notificationContainer.appendChild(notification);

        // Tampilkan notifikasi
        setTimeout(() => notification.classList.add('show'), 100);

        // Hapus notifikasi setelah 5 detik
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 5000);
    }

    // Fungsi untuk melihat detail laporan
    function viewReportDetails(reportId, collection) {
        console.log(`Viewing report ${reportId} from ${collection}`);
        
        // Redirect ke halaman detail yang sesuai
        if (collection === 'pendingReports') {
            window.location.href = `detail-pending.html?id=${reportId}`;
        } else if (collection === 'solvedReports') {
            window.location.href = `detail-solved.html?id=${reportId}`;
        } else if (collection === 'maintenanceReports') {
            window.location.href = `detail-maintenance.html?id=${reportId}`;
        } else if (collection === 'solvedMaintenance') {
            window.location.href = `detail-solved-maintenance.html?id=${reportId}`;
        } else {
            showNotification('Cannot view details for this report type', 'error');
        }
    }

    // Fungsi untuk memperbarui tabel summary
function updateSummaryTable(reports) {
    console.log("Updating summary table with", reports.length, "reports");
    
    // Terapkan filter terlebih dahulu
    const filteredReports = applyFilters(reports);
    console.log("After applying filters:", filteredReports.length, "reports");
    
    // Kemudian setup pagination
    setupPagination(filteredReports);
}
// Tambahkan fungsi untuk mengecek status filter
function checkFilterStatus() {
    console.log("=== FILTER STATUS ===");
    console.log("Date Range:", document.getElementById('dateRange').value);
    console.log("Category Filter:", document.getElementById('categoryFilter').value);
    console.log("Brand Filter:", document.getElementById('brandFilter').value);
    console.log("Total Reports Data:", allReportsData.length);
    console.log("=====================");
}

// Panggil fungsi ini di event listeners untuk debugging
categoryFilter.addEventListener('change', () => {
    checkFilterStatus();
    // ... kode lainnya
});

brandFilter.addEventListener('change', () => {
    checkFilterStatus();
    // ... kode lainnya
});
    // Fungsi untuk mengekspor data
    function exportData() {
        try {
            const filteredReports = applyFilters(allReportsData);
            
            if (filteredReports.length === 0) {
                showNotification('No data to export', 'info');
                return;
            }

            // Siapkan data CSV
            let csvContent = "Date,Report ID,Category,Status,Brand,Resolution Time\n";
            
            filteredReports.forEach(report => {
                // Format tanggal
                let reportDate;
                try {
                    reportDate = report.date.toDate ? report.date.toDate() : new Date(report.date);
                    reportDate = reportDate.toLocaleDateString('id-ID');
                } catch (error) {
                    reportDate = 'N/A';
                }
                
                // Format resolution time
                let resolutionTime = 'N/A';
                if (report.resolutionTime) {
                    const hours = Math.floor(report.resolutionTime / 60);
                    const minutes = report.resolutionTime % 60;
                    resolutionTime = `${hours}h ${minutes}m`;
                }
                
                const row = [
                    reportDate,
                    report.id || 'N/A',
                    report.category || 'N/A',
                    report.status || 'N/A',
                    report.brand || 'N/A',
                    resolutionTime
                ].map(field => `"${field}"`).join(',');
                
                csvContent += row + '\n';
            });

            // Buat blob dan download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `reports_export_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data exported successfully', 'success');
            
        } catch (error) {
            console.error('Export error:', error);
            showNotification('Failed to export data', 'error');
        }
    }

    // ========== EVENT LISTENERS ==========

document.addEventListener('DOMContentLoaded', function() {
    console.log("Dashboard initialized");
    
    // Inisialisasi cache
    window.pendingReportsCache = [];
    window.solvedReportsCache = [];
    window.maintenanceReportsCache = [];
    window.solvedMaintenanceCache = [];
    window.newGamesData = [];
    window.featuresData = [];

    // Setup listeners
    setupReportsListener();
    setupNewReleasesListener();
    setupReleasesListeners(); // ← TAMBAH BARIS INI

       setTimeout(checkFirestoreCollections, 3000);

       // Di dalam DOMContentLoaded, perbaiki event listeners:
const categoryFilter = document.getElementById('categoryFilter');
const brandFilter = document.getElementById('brandFilter');

if (categoryFilter) {
    categoryFilter.addEventListener('change', () => {
        console.log("Category filter changed to:", categoryFilter.value);
        currentPage = 1;
        
        // Update charts dengan data yang difilter
        updateChartsWithFilteredData(allReportsData);
        
        // Update table dengan data yang difilter
        updateSummaryTable(allReportsData);
    });
}

if (brandFilter) {
    brandFilter.addEventListener('change', () => {
        console.log("Brand filter changed to:", brandFilter.value);
        currentPage = 1;
        
        // Update charts dengan data yang difilter
        updateChartsWithFilteredData(allReportsData);
        
        // Update table dengan data yang difilter
        updateSummaryTable(allReportsData);
    });
}
        
        // Setup search listener
        const searchInput = document.getElementById('summarySearch');
        if (searchInput) {
            searchInput.addEventListener('input', handleSearch);
        }
        
        // Setup pagination listeners
        const prevButton = document.getElementById('prevPage');
        const nextButton = document.getElementById('nextPage');
        
        if (prevButton) {
            prevButton.addEventListener('click', () => goToPage(currentPage - 1));
        }
        
        if (nextButton) {
            nextButton.addEventListener('click', () => goToPage(currentPage + 1));
        }
        
        // Setup export button
        const exportButton = document.getElementById('exportBtn');
        if (exportButton) {
            exportButton.addEventListener('click', exportData);
        }
        
const dateRangeSelect = document.getElementById('dateRange');
if (dateRangeSelect) {
    dateRangeSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
            // Handle custom date range (bisa diimplementasikan nanti)
            showNotification('Custom date range feature coming soon', 'info');
            this.value = '30'; // Kembali ke default untuk sementara
            return;
        }
        
        dateRangeFilter = parseInt(this.value);
        console.log("Date range changed to:", dateRangeFilter);
        
        // Setup ulang listener dengan range baru
        setupReportsListener();
    });
}
        // Setup tab navigation
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                // Update active tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Show/hide tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            });
        });
        
        // Setup logout functionality
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    auth.signOut().then(() => {
                        window.location.href = 'login.html';
                    }).catch(error => {
                        console.error('Logout error:', error);
                        showNotification('Logout failed', 'error');
                    });
                }
            });
        }
        
        // Setup responsive menu toggle
        const menuToggle = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        
        if (menuToggle && sidebar) {
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });
        }
        
        // Setup auth state listener
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'login.html';
            }
        });
    });

    // ========== CLEANUP FUNCTIONS ==========

    // Fungsi untuk membersihkan listener saat halaman ditutup
    window.addEventListener('beforeunload', function() {
        if (reportsListener) {
            reportsListener();
        }
        if (newGamesListener) {
            newGamesListener();
        }
    });
   // Fungsi untuk setup listener data game dan fitur baru
// Fungsi untuk setup listener data game dan fitur baru
function setupNewReleasesListener() {
    console.log("Setting up new releases listener...");
    
    // Hentikan listener sebelumnya jika ada
    if (newGamesListener) {
        newGamesListener();
    }
    
    try {
        // Listener untuk new game releases
        const unsubscribeGames = db.collection('newGame').onSnapshot(snapshot => {
            const gameCount = snapshot.docs.length;
            document.getElementById('newGameReleases').textContent = gameCount;
            console.log("New Game Releases updated:", gameCount);
            
            // Simpan data untuk penggunaan lain jika diperlukan
            const gamesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            window.newGamesData = gamesData;
            
        }, error => {
            console.error("Error fetching new games:", error);
            showNotification('Gagal memuat data game baru', 'error');
            document.getElementById('newGameReleases').textContent = '0';
        });

        // Listener untuk new feature releases dengan error handling yang lebih baik
        const unsubscribeFeatures = db.collection('releases').onSnapshot(snapshot => {
            const featureCount = snapshot.docs.length;
            document.getElementById('newfeatureReleases').textContent = featureCount;
            console.log("New Feature Releases updated:", featureCount);
        }, error => {
            console.error("Error fetching new features:", error);
            // Coba koleksi alternatif jika newFeatures tidak ada
            tryAlternativeFeatureCollection();
        });

        // Simpan fungsi unsubscribe untuk pembersihan
        newGamesListener = () => {
            unsubscribeGames();
            unsubscribeFeatures();
            console.log("New releases listeners removed");
        };
        
        return newGamesListener;
        
    } catch (error) {
        console.error("Error setting up new releases listener:", error);
        // Set nilai default jika error
        document.getElementById('newGameReleases').textContent = '0';
        document.getElementById('newfeatureReleases').textContent = '0';
        return () => {}; // Return empty unsubscribe function
    }
}


// Tambahkan juga fungsi untuk debugging
function checkFirestoreCollections() {
    console.log("Checking available Firestore collections...");
    
    // Anda bisa menambahkan logika untuk mengecek koleksi yang tersedia
    // Ini membantu debugging jika koleksi tidak ada
    const collectionsToCheck = ['newGame', 'newFeatures', 'newFeature', 'features'];
    
    collectionsToCheck.forEach(collectionName => {
        db.collection(collectionName).get().then(snapshot => {
            console.log(`Collection ${collectionName}: ${snapshot.docs.length} documents`);
        }).catch(error => {
            console.log(`Collection ${collectionName} does not exist or error:`, error);
        });
    });
}
// Fungsi untuk setup listener data releases
function setupReleasesListeners() {
    console.log("Setting up releases listeners...");
    
    // Listener untuk new game releases
    db.collection('newGame').onSnapshot(snapshot => {
        const gamesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        window.newGamesData = gamesData;
        console.log("New games data updated:", gamesData.length);
        updateReleasesCharts();
    }, error => {
        console.error("Error fetching new games:", error);
    });

    // Listener untuk new feature releases
    db.collection('releases').onSnapshot(snapshot => {
        const featuresData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        window.featuresData = featuresData;
        console.log("New features data updated:", featuresData.length);
        updateReleasesCharts();
    }, error => {
        console.error("Error fetching new features:", error);
        // Coba koleksi alternatif
        tryAlternativeFeatureCollection();
    });
}

// Fungsi untuk memperbarui chart releases
function updateReleasesCharts() {
    const gamesData = window.newGamesData || [];
    const featuresData = window.featuresData || [];
    
    updateGameReleasesChart(gamesData);
    updateFeatureReleasesChart(featuresData);
}

// Fungsi untuk chart New Game Releases
function updateGameReleasesChart(gamesData) {
    const ctx = document.getElementById('gameReleasesChart').getContext('2d');
    
    // Hancurkan chart sebelumnya jika ada
    if (window.gameReleasesChartInstance) {
        window.gameReleasesChartInstance.destroy();
    }
    
    // Analisis data game
    const stats = analyzeGameData(gamesData);
    
    window.gameReleasesChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total Games', 'Upcoming', 'Released', 'Popular (4.5+)'],
            datasets: [{
                label: 'Game Statistics',
                data: [
                    stats.totalGames,
                    stats.upcomingGames,
                    stats.releasedGames,
                    stats.popularGames
                ],
                backgroundColor: [
                    '#4361ee', // Total - Biru
                    '#f72585', // Upcoming - Pink
                    '#4cc9f0', // Released - Cyan
                    '#3a0ca3'  // Popular - Ungu
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${context.raw}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Games'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Game Categories'
                    }
                }
            }
        }
    });
}

// Fungsi untuk chart New Feature Releases
function updateFeatureReleasesChart(featuresData) {
    const ctx = document.getElementById('featureReleasesChart').getContext('2d');
    
    // Hancurkan chart sebelumnya jika ada
    if (window.featureReleasesChartInstance) {
        window.featureReleasesChartInstance.destroy();
    }
    
    // Analisis data feature
    const stats = analyzeFeatureData(featuresData);
    
    window.featureReleasesChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.data,
                backgroundColor: [
                    '#4361ee', '#4cc9f0', '#4895ef', '#560bad', 
                    '#f72585', '#b5179e', '#7209b7', '#3a0ca3'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 12,
                        font: {
                            size: 11
                        }
                    }
                }
            }
        }
    });
}

// Fungsi untuk menganalisis data game
function analyzeGameData(gamesData) {
    const totalGames = gamesData.length;
    const upcomingGames = gamesData.filter(game => 
        game.status && game.status.toLowerCase() === 'upcoming').length;
    
    const releasedGames = gamesData.filter(game => 
        game.status && game.status.toLowerCase() === 'released').length;
    
    const popularGames = gamesData.filter(game => {
        const rating = parseFloat(game.rating);
        return !isNaN(rating) && rating >= 4.5;
    }).length;
    
    return {
        totalGames,
        upcomingGames,
        releasedGames,
        popularGames
    };
}

// Fungsi untuk menganalisis data feature
function analyzeFeatureData(featuresData) {
    // Kelompokkan berdasarkan status atau kategori
    const statusCounts = {};
    
    featuresData.forEach(feature => {
        const status = feature.status || 'Unknown';
        statusCounts[status] = (statusCounts[status] || 0) + 1;
    });
    
    // Jika tidak ada status, gunakan kategori atau buat default
    if (Object.keys(statusCounts).length === 0) {
        return {
            labels: ['Features'],
            data: [featuresData.length]
        };
    }
    
    return {
        labels: Object.keys(statusCounts),
        data: Object.values(statusCounts)
    };
}

// Fungsi untuk analisis bulanan releases
function getMonthlyReleasesData(gamesData, featuresData) {
    const monthlyData = {};
    const months = [];
    
    // Generate last 6 months
    for (let i = 5; i >= 0; i--) {
        const date = new Date();
        date.setMonth(date.getMonth() - i);
        const monthKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
        months.push(monthKey);
        monthlyData[monthKey] = { games: 0, features: 0 };
    }
    
    // Hitung releases per bulan untuk games
    gamesData.forEach(game => {
        if (game.releaseDate) {
            try {
                const releaseDate = game.releaseDate.toDate ? game.releaseDate.toDate() : new Date(game.releaseDate);
                const monthKey = releaseDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey].games++;
                }
            } catch (error) {
                console.error("Error processing game release date:", error);
            }
        }
    });
    
    // Hitung releases per bulan untuk features
    featuresData.forEach(feature => {
        if (feature.releaseDate) {
            try {
                const releaseDate = feature.releaseDate.toDate ? feature.releaseDate.toDate() : new Date(feature.releaseDate);
                const monthKey = releaseDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey].features++;
                }
            } catch (error) {
                console.error("Error processing feature release date:", error);
            }
        }
    });
    
    return {
        months,
        data: monthlyData
    };
}
// Fungsi untuk mengatur tanggal default pada filter
function setupDateFilters() {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (startDateInput && endDateInput) {
        // Set end date to today
        const today = new Date();
        endDateInput.valueAsDate = today;
        
        // Set start date to 30 days ago
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        startDateInput.valueAsDate = thirtyDaysAgo;
        
        // Add event listeners for date changes
        startDateInput.addEventListener('change', applyDateFilter);
        endDateInput.addEventListener('change', applyDateFilter);
    }
}

// Fungsi untuk menerapkan filter tanggal
function applyDateFilter() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    if (startDate && endDate) {
        console.log("Date filter applied:", startDate, "to", endDate);
        // Di sini Anda bisa menambahkan logika untuk memfilter data berdasarkan tanggal
        // updateChartsWithFilteredData(allReportsData);
        // updateSummaryTable(allReportsData);
    }
}

// Panggil fungsi setup saat DOM siap
document.addEventListener('DOMContentLoaded', function() {
    setupDateFilters();
    // ... kode lainnya
});
// ========== FUNGSI FILTER TANGGAL ==========

function applyDateFilter(reports) {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (!startDateInput || !endDateInput || !startDateInput.value || !endDateInput.value) {
        return reports; // Kembalikan semua data jika filter tanggal tidak lengkap
    }
    
    const startDate = new Date(startDateInput.value);
    const endDate = new Date(endDateInput.value);
    
    // Set end date to end of day
    endDate.setHours(23, 59, 59, 999);
    
    console.log("Date filter - Start:", startDate, "End:", endDate);
    
    const filteredReports = reports.filter(report => {
        try {
            let reportDate;
            
            // Handle different date formats from different collections
            if (report.date && report.date.toDate) {
                reportDate = report.date.toDate();
            } else if (report.dateCreated && report.dateCreated.toDate) {
                reportDate = report.dateCreated.toDate();
            } else if (report.dateCompleted && report.dateCompleted.toDate) {
                reportDate = report.dateCompleted.toDate();
            } else if (report.date) {
                reportDate = new Date(report.date);
            } else {
                return false; // Skip reports without date
            }
            
            // Convert to Indonesia timezone (UTC+7) for accurate comparison
            const offset = 7;
            const localTime = reportDate.getTime();
            const localOffset = reportDate.getTimezoneOffset() * 60000;
            const utc = localTime + localOffset;
            const indonesiaTime = new Date(utc + (3600000 * offset));
            
            return indonesiaTime >= startDate && indonesiaTime <= endDate;
            
        } catch (error) {
            console.error("Error processing report date:", error, report);
            return false;
        }
    });
    
    console.log("After date filtering:", filteredReports.length, "reports");
    return filteredReports;
}

// ========== PERBAIKAN FUNGSI APPLYFILTERS ==========

function applyFilters(reports) {
    const categoryFilter = document.getElementById('categoryFilter').value;
    const brandFilter = document.getElementById('brandFilter').value;
    
    let filteredReports = reports;
    
    // Filter berdasarkan kategori
    if (categoryFilter !== 'all') {
        filteredReports = filteredReports.filter(report => {
            // Handle berbagai format kategori yang mungkin
            const reportCategory = report.category || report.status || '';
            
            // Mapping untuk kategori yang spesifik
            if (categoryFilter === 'Pending' && report.status === 'Pending') return true;
            if (categoryFilter === 'Solved' && report.status === 'Solved') return true;
            if (categoryFilter === 'Maintenance' && report.status === 'Maintenance') return true;
            if (categoryFilter === 'Maintenance Solved' && report.status === 'Maintenance Solved') return true;
            if (categoryFilter === 'Releases New Feature' && report.category === 'Releases New Feature') return true;
            if (categoryFilter === 'Releases New Game' && report.category === 'Releases New Game') return true;
            
            return reportCategory === categoryFilter;
        });
    }
    
    // Filter berdasarkan brand
    if (brandFilter !== 'all') {
        filteredReports = filteredReports.filter(report => {
            const reportBrand = report.brand || '';
            return reportBrand === brandFilter;
        });
    }
    
    // Filter berdasarkan tanggal (TAMBAH BARIS INI)
    filteredReports = applyDateFilter(filteredReports);
    
    console.log("After all filtering - Category:", categoryFilter, "Brand:", brandFilter, "Results:", filteredReports.length);
    return filteredReports;
}

// ========== PERBAIKAN FUNGSI UPDATE DENGAN FILTER ==========

function updateChartsWithFilteredData(reports) {
    const filteredReports = applyFilters(reports);
    updateCharts(filteredReports);
}

function updateDashboardWithFilteredData(reports) {
    const filteredReports = applyFilters(reports);
    updateDashboardStats(filteredReports);
}

function updateSummaryWithFilteredData(reports) {
    const filteredReports = applyFilters(reports);
    updateSummaryTable(filteredReports);
}

// ========== FUNGSI RESET FILTER TANGGAL ==========

function resetDateFilter() {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (startDateInput && endDateInput) {
        // Reset to default (last 30 days)
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        
        startDateInput.valueAsDate = thirtyDaysAgo;
        endDateInput.valueAsDate = today;
        
        console.log("Date filter reset to default");
    }
}

// ========== FUNGSI VALIDASI TANGGAL ==========

function validateDateRange() {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (!startDateInput.value || !endDateInput.value) {
        return true; // Allow empty dates
    }
    
    const startDate = new Date(startDateInput.value);
    const endDate = new Date(endDateInput.value);
    
    if (startDate > endDate) {
        showNotification('Start date cannot be after end date', 'error');
        // Auto-correct by swapping dates
        startDateInput.valueAsDate = endDate;
        endDateInput.valueAsDate = startDate;
        return false;
    }
    
    // Validate that range is not too large (optional)
    const diffTime = Math.abs(endDate - startDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays > 365) {
        showNotification('Date range cannot exceed 1 year', 'warning');
    }
    
    return true;
}

// ========== PERBAIKAN EVENT LISTENERS ==========

document.addEventListener('DOMContentLoaded', function() {
    console.log("Dashboard initialized");
    
    // Inisialisasi cache
    window.pendingReportsCache = [];
    window.solvedReportsCache = [];
    window.maintenanceReportsCache = [];
    window.solvedMaintenanceCache = [];
    window.newGamesData = [];
    window.featuresData = [];

    // Setup listeners
    setupReportsListener();
    setupNewReleasesListener();
    setupReleasesListeners();

    setTimeout(checkFirestoreCollections, 3000);

    // Setup filter event listeners
    const categoryFilter = document.getElementById('categoryFilter');
    const brandFilter = document.getElementById('brandFilter');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');

    // Event listener untuk category filter
    if (categoryFilter) {
        categoryFilter.addEventListener('change', () => {
            console.log("Category filter changed to:", categoryFilter.value);
            currentPage = 1;
            updateAllWithFilters();
        });
    }

    // Event listener untuk brand filter
    if (brandFilter) {
        brandFilter.addEventListener('change', () => {
            console.log("Brand filter changed to:", brandFilter.value);
            currentPage = 1;
            updateAllWithFilters();
        });
    }

    // Event listener untuk date filter (TAMBAH INI)
    if (startDateInput && endDateInput) {
        startDateInput.addEventListener('change', function() {
            if (validateDateRange()) {
                console.log("Start date changed to:", this.value);
                currentPage = 1;
                updateAllWithFilters();
            }
        });
        
        endDateInput.addEventListener('change', function() {
            if (validateDateRange()) {
                console.log("End date changed to:", this.value);
                currentPage = 1;
                updateAllWithFilters();
            }
        });
    }

    // Setup search listener
    const searchInput = document.getElementById('summarySearch');
    if (searchInput) {
        searchInput.addEventListener('input', handleSearch);
    }
    
    // Setup pagination listeners
    const prevButton = document.getElementById('prevPage');
    const nextButton = document.getElementById('nextPage');
    
    if (prevButton) {
        prevButton.addEventListener('click', () => goToPage(currentPage - 1));
    }
    
    if (nextButton) {
        nextButton.addEventListener('click', () => goToPage(currentPage + 1));
    }
    
    // Setup export button
    const exportButton = document.getElementById('exportBtn');
    if (exportButton) {
        exportButton.addEventListener('click', exportData);
    }

    // Setup date filters dengan nilai default
    setupDateFilters();
    
    // ... kode lainnya yang sudah ada
});

// ========== FUNGSI UNTUK UPDATE SEMUA KOMPONEN DENGAN FILTER ==========

function updateAllWithFilters() {
    if (allReportsData && allReportsData.length > 0) {
        updateDashboardWithFilteredData(allReportsData);
        updateChartsWithFilteredData(allReportsData);
        updateSummaryWithFilteredData(allReportsData);
    }
}

// ========== PERBAIKAN FUNGSI SETUPDATEFILTERS ==========

function setupDateFilters() {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (startDateInput && endDateInput) {
        // Set end date to today
        const today = new Date();
        endDateInput.valueAsDate = today;
        
        // Set start date to 30 days ago
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        startDateInput.valueAsDate = thirtyDaysAgo;
        
        console.log("Date filters initialized");
    }
}
</script>
</body>
</html>
