<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task History - Operations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="global.css">
    <script src="global-time.js"></script>
    <style>
    :root {
        --primary-gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        --success-gradient: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
        --warning-gradient: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
        --info-gradient: linear-gradient(135deg, #4895ef 0%, #3f37c9 100%);
        --completed-color: #10b981;
        --pending-color: #f59e0b;
        --overdue-color: #ef4444;
    }

    .main-content {
        padding: var(--space-lg);
        background-color: var(--bg-secondary);
        min-height: 100vh;
    }

    .header {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin-bottom: var(--space-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header h1 {
        font-size: var(--text-2xl);
        font-weight: var(--font-semibold);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin: 0;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: var(--space-lg);
    }

    .search-bar {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-bar i {
        position: absolute;
        left: 12px;
        color: var(--text-secondary);
    }

    .search-bar input {
        padding: var(--space-sm) var(--space-sm) var(--space-sm) 40px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        background-color: var(--input-bg);
        color: var(--text-primary);
        font-size: var(--text-sm);
        width: 250px;
    }

    .user-profile {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }

    .user-info h4 {
        margin: 0;
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        color: var(--text-primary);
    }

    .user-info p {
        margin: 0;
        font-size: var(--text-xs);
        color: var(--text-secondary);
    }

    .history-container {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        margin-bottom: var(--space-xl);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-lg);
        padding-bottom: var(--space-md);
        border-bottom: 1px solid var(--border-color);
        flex-wrap: wrap;
        gap: var(--space-md);
    }

    .section-title {
        font-size: var(--text-xl);
        font-weight: var(--font-semibold);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin: 0;
    }

    .filter-controls {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .filter-label {
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
        color: var(--text-secondary);
    }

    .filter-input {
        padding: var(--space-xs) var(--space-sm);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        background-color: var(--input-bg);
        color: var(--text-primary);
        font-size: var(--text-sm);
    }

    .btn {
        padding: var(--space-sm) var(--space-md);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        cursor: pointer;
        transition: all var(--transition-fast);
        border: none;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-outline {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
    }

    .btn-outline:hover {
        background: var(--hover-color);
        color: var(--text-primary);
    }

    .task-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }

    .task-item {
        background: var(--card-bg);
        border-radius: var(--radius-md);
        padding: var(--space-md);
        border: 1px solid var(--border-color);
        transition: all var(--transition-fast);
    }

    .task-item:hover {
        box-shadow: var(--shadow-sm);
        transform: translateY(-2px);
    }

    .task-item.completed {
        background-color: rgba(16, 185, 129, 0.05);
        border-left: 4px solid var(--completed-color);
    }

    .task-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-sm);
    }

    .task-title {
        font-weight: var(--font-semibold);
        font-size: var(--text-md);
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }

    .task-status {
        padding: 4px 8px;
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
    }

    .status-completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--completed-color);
    }

    .status-pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--pending-color);
    }

    .task-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-md);
        margin-bottom: var(--space-sm);
    }

    .task-category, .task-time, .task-date {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: var(--text-xs);
        color: var(--text-secondary);
    }

    .task-description {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        line-height: 1.5;
        padding-top: var(--space-sm);
        border-top: 1px solid var(--border-color-light);
    }

    .empty-state {
        text-align: center;
        padding: var(--space-xl) var(--space-lg);
        background-color: var(--card-bg);
        border-radius: var(--radius-lg);
        border: 2px dashed var(--border-color);
        margin: var(--space-lg) 0;
    }

    .empty-state i {
        font-size: 3rem;
        color: var(--text-tertiary);
        margin-bottom: var(--space-md);
    }

    .empty-state h3 {
        font-size: var(--text-lg);
        font-weight: var(--font-semibold);
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }

    .empty-state p {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        margin-bottom: var(--space-lg);
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .notification {
        padding: 12px 16px;
        border-radius: var(--radius-md);
        background: var(--card-bg);
        border-left: 4px solid var(--primary);
        box-shadow: var(--shadow-md);
        display: flex;
        align-items: center;
        gap: 10px;
        animation: notificationSlideIn 0.5s ease forwards;
        max-width: 350px;
        position: relative;
    }

    .notification.success {
        border-left-color: var(--completed-color);
    }

    .notification.error {
        border-left-color: var(--overdue-color);
    }

    .notification.info {
        border-left-color: var(--primary);
    }

    .notification button.notification-close {
        background: none;
        border: none;
        cursor: pointer;
        margin-left: auto;
        color: var(--text-secondary);
        padding: 4px;
        border-radius: 4px;
        transition: background-color 0.2s ease;
    }

    .notification button.notification-close:hover {
        color: var(--text-primary);
        background-color: rgba(0, 0, 0, 0.1);
    }

    .notification.hiding {
        animation: notificationSlideOut 0.5s ease forwards;
    }

    @keyframes notificationSlideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes notificationSlideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    /* Responsive Adjustments */
    @media (max-width: 1024px) {
        .header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .header-actions {
            width: 100%;
            justify-content: space-between;
        }

        .search-bar input {
            width: 200px;
        }
    }

    @media (max-width: 768px) {
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .filter-controls {
            width: 100%;
            flex-direction: column;
            align-items: flex-start;
        }

        .filter-group {
            width: 100%;
        }

        .filter-input {
            width: 100%;
        }

        .header-actions {
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .search-bar {
            order: 3;
            width: 100%;
        }

        .search-bar input {
            width: 100%;
        }

        .task-meta {
            flex-direction: column;
            gap: var(--space-xs);
            align-items: flex-start;
        }
    }

    @media (max-width: 480px) {
        .task-header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-sm);
        }

        .task-status {
            align-self: flex-start;
        }
    }
    </style>
</head>
<body>
    <div id="sidebar-container"></div>
<button class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1><i class="fas fa-history"></i> Task History</h1>
                <div class="header-actions">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Cari task..." id="searchTasks">
                    </div>
                    <div class="user-profile">
                        <img class="profile-img" src="https://iili.io/Fpiva7S.png" alt="Profile">
                        <div class="user-info">
                            <h4>Adrian Abdul Arif</h4>
                            <p>Customer Service Support</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="history-container fade-in">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-filter"></i> Riwayat Tugas</h2>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label class="filter-label" for="filterDate">Filter Tanggal</label>
                            <input type="date" id="filterDate" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label" for="filterCategory">Filter Kategori</label>
                            <select id="filterCategory" class="filter-input">
                                <option value="">Semua Kategori</option>
                                <option value="Share Promosi Panel">Share Promosi Panel</option>
                                <option value="Check Domain">Check Domain</option>
                                <option value="Check Game">Check Game</option>
                                <option value="Check Pending">Check Pending</option>
                                <option value="Check Maintenance">Check Maintenance</option>
                                <option value="Other">Lainnya</option>
                            </select>
                        </div>
                        <button class="btn btn-outline" id="clearFilter">
                            <i class="fas fa-times"></i> Reset Filter
                        </button>
                    </div>
                </div>
                
                <div class="task-list" id="taskList">
                    <!-- Tasks will be loaded here dynamically -->
                </div>
                
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-inbox"></i>
                    <h3>Tidak ada riwayat tugas</h3>
                    <p>Belum ada tugas yang diselesaikan atau sesuai dengan filter yang dipilih.</p>
                </div>
            </div>
        </div>
    </div>
<div class="notification-container" id="notificationContainer"></div>
    
    <script src="sidebar-loader.js"></script>
    <script src="user-profile.js"></script>
  <script>
    // Data untuk tugas - diambil dari localStorage dengan struktur yang benar
    let tasksData = [];
    
    // Elemen DOM
    const taskList = document.getElementById('taskList');
    const emptyState = document.getElementById('emptyState');
    const searchTasks = document.getElementById('searchTasks');
    const filterDate = document.getElementById('filterDate');
    const filterCategory = document.getElementById('filterCategory');
    const clearFilter = document.getElementById('clearFilter');
    
    // Inisialisasi
    document.addEventListener('DOMContentLoaded', function() {
        loadTasksData();
        renderTasks();
        
        // Event listeners
        searchTasks.addEventListener('input', filterTasks);
        filterDate.addEventListener('change', filterTasks);
        filterCategory.addEventListener('change', filterTasks);
        clearFilter.addEventListener('click', resetFilters);
    });
    
    // Fungsi untuk memuat data tugas
    function loadTasksData() {
        const savedData = localStorage.getItem('dailyTasksData');
        
        if (savedData) {
            try {
                const parsedData = JSON.parse(savedData);
                
                // Pastikan kita memiliki array tasks
                if (parsedData.tasks && Array.isArray(parsedData.tasks)) {
                    tasksData = parsedData.tasks;
                    
                    // Pastikan setiap task memiliki properti yang diperlukan
                    tasksData = tasksData.map(task => {
                        return {
                            id: task.id || 'task-' + Date.now(),
                            title: task.title || 'Untitled Task',
                            category: task.category || 'Other',
                            time: task.time || null,
                            description: task.description || '',
                            completed: task.completed || false,
                            date: task.date || new Date().toISOString().split('T')[0],
                            createdAt: task.createdAt || new Date().toISOString()
                        };
                    });
                } else {
                    tasksData = [];
                    console.warn('No valid tasks data found in localStorage');
                }
            } catch (e) {
                console.error('Error parsing tasks data:', e);
                tasksData = [];
            }
        } else {
            console.warn('No dailyTasksData found in localStorage');
            tasksData = [];
        }
    }
    
    // Fungsi untuk merender tugas
    function renderTasks(tasksToRender = null) {
        let tasks = tasksToRender;
        
        if (!tasks) {
            const filterDateValue = filterDate.value;
            const categoryFilter = filterCategory.value;
            const searchTerm = searchTasks.value.toLowerCase();
            
            tasks = tasksData.filter(task => {
                // Filter berdasarkan pencarian
                if (searchTerm && !(
                    task.title.toLowerCase().includes(searchTerm) ||
                    (task.description && task.description.toLowerCase().includes(searchTerm))
                )) {
                    return false;
                }
                
                // Filter berdasarkan tanggal jika dipilih
                if (filterDateValue && task.date !== filterDateValue) {
                    return false;
                }
                
                // Filter berdasarkan kategori jika dipilih
                if (categoryFilter && task.category !== categoryFilter) {
                    return false;
                }
                
                return true;
            });
        }
        
        // Urutkan berdasarkan tanggal (terbaru pertama)
        const sortedTasks = [...tasks].sort((a, b) => {
            return new Date(b.date) - new Date(a.date);
        });
        
        if (sortedTasks.length === 0) {
            emptyState.style.display = 'block';
            taskList.style.display = 'none';
            return;
        }
        
        emptyState.style.display = 'none';
        taskList.style.display = 'flex';
        taskList.innerHTML = '';
        
        sortedTasks.forEach(task => {
            const taskItem = document.createElement('div');
            taskItem.className = `task-item ${task.completed ? 'completed' : ''} fade-in`;
            
            // Format tanggal - pastikan format yang konsisten
            let taskDate;
            try {
                // Coba parsing format YYYY-MM-DD
                if (task.date && task.date.includes('-')) {
                    const parts = task.date.split('-');
                    taskDate = new Date(parts[0], parts[1] - 1, parts[2]);
                } else {
                    // Fallback ke Date parsing biasa
                    taskDate = new Date(task.date);
                }
            } catch (e) {
                // Jika parsing gagal, gunakan tanggal sekarang
                taskDate = new Date();
            }
            
            const formattedDate = taskDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            taskItem.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <span class="task-status ${task.completed ? 'status-completed' : 'status-pending'}">
                        <i class="fas ${task.completed ? 'fa-check-circle' : 'fa-clock'}"></i>
                        ${task.completed ? 'Selesai' : 'Pending'}
                    </span>
                </div>
                <div class="task-meta">
                    <span class="task-category">
                        <i class="fas fa-folder"></i> ${task.category}
                    </span>
                    ${task.time ? `
                    <span class="task-time">
                        <i class="fas fa-clock"></i> ${task.time} menit
                    </span>
                    ` : ''}
                    <span class="task-date">
                        <i class="fas fa-calendar"></i> ${formattedDate}
                    </span>
                </div>
                ${task.description ? `
                <div class="task-description">
                    ${task.description}
                </div>
                ` : ''}
            `;
            
            taskList.appendChild(taskItem);
        });
    }
    
    // Fungsi untuk memfilter tugas
    function filterTasks() {
        const searchTerm = searchTasks.value.toLowerCase();
        const dateFilter = filterDate.value;
        const categoryFilter = filterCategory.value;
        
        let filteredTasks = tasksData;
        
        // Filter berdasarkan pencarian
        if (searchTerm) {
            filteredTasks = filteredTasks.filter(task => 
                task.title.toLowerCase().includes(searchTerm) ||
                (task.description && task.description.toLowerCase().includes(searchTerm))
            );
        }
        
        // Filter berdasarkan tanggal
        if (dateFilter) {
            filteredTasks = filteredTasks.filter(task => task.date === dateFilter);
        }
        
        // Filter berdasarkan kategori
        if (categoryFilter) {
            filteredTasks = filteredTasks.filter(task => task.category === categoryFilter);
        }
        
        renderTasks(filteredTasks);
    }
    
    // Fungsi untuk mereset filter
    function resetFilters() {
        searchTasks.value = '';
        filterDate.value = '';
        filterCategory.value = '';
        renderTasks();
    }
    // ========== TRANSLATIONS FOR TASK HISTORY ==========
const taskHistoryTranslations = {
    id: {
        // Header
        "pageTitle": "Riwayat Tugas",
        "searchPlaceholder": "Cari tugas...",
        
        // Section Header
        "sectionTitle": "Riwayat Tugas",
        "filterDate": "Filter Tanggal",
        "filterCategory": "Filter Kategori",
        "allCategories": "Semua Kategori",
        "clearFilter": "Reset Filter",
        
        // Categories
        "sharePromotion": "Share Promosi Panel",
        "checkDomain": "Check Domain",
        "checkGame": "Check Game",
        "checkPending": "Check Pending",
        "checkMaintenance": "Check Maintenance",
        "other": "Lainnya",
        
        // Task Status
        "completed": "Selesai",
        "pending": "Pending",
        
        // Empty State
        "noHistory": "Tidak ada riwayat tugas",
        "noHistoryMessage": "Belum ada tugas yang diselesaikan atau sesuai dengan filter yang dipilih.",
        
        // Task Meta
        "minutes": "menit",
        
        // User Roles
        "superAdmin": "Super Administrator",
        "customerSupport": "Customer Service Support",
        "localStorageMode": "Mode Local Storage"
    },
    
    en: {
        // Header
        "pageTitle": "Task History",
        "searchPlaceholder": "Search tasks...",
        
        // Section Header
        "sectionTitle": "Task History",
        "filterDate": "Filter Date",
        "filterCategory": "Filter Category",
        "allCategories": "All Categories",
        "clearFilter": "Reset Filter",
        
        // Categories
        "sharePromotion": "Share Promosi Panel",
        "checkDomain": "Check Domain",
        "checkGame": "Check Game",
        "checkPending": "Check Pending",
        "checkMaintenance": "Check Maintenance",
        "other": "Other",
        
        // Task Status
        "completed": "Completed",
        "pending": "Pending",
        
        // Empty State
        "noHistory": "No task history",
        "noHistoryMessage": "No completed tasks or tasks matching the selected filters.",
        
        // Task Meta
        "minutes": "minutes",
        
        // User Roles
        "superAdmin": "Super Administrator",
        "customerSupport": "Customer Service Support",
        "localStorageMode": "Local Storage Mode"
    },
    
    ja: {
        // Header
        "pageTitle": "タスク履歴",
        "searchPlaceholder": "タスクを検索...",
        
        // Section Header
        "sectionTitle": "タスク履歴",
        "filterDate": "日付でフィルター",
        "filterCategory": "カテゴリでフィルター",
        "allCategories": "すべてのカテゴリ",
        "clearFilter": "フィルターをリセット",
        
        // Categories
        "sharePromotion": "プロモーション共有パネル",
        "checkDomain": "ドメイン確認",
        "checkGame": "ゲーム確認",
        "checkPending": "保留中確認",
        "checkMaintenance": "メンテナンス確認",
        "other": "その他",
        
        // Task Status
        "completed": "完了",
        "pending": "保留中",
        
        // Empty State
        "noHistory": "タスク履歴がありません",
        "noHistoryMessage": "完了したタスクまたは選択したフィルターに一致するタスクがありません。",
        
        // Task Meta
        "minutes": "分",
        
        // User Roles
        "superAdmin": "スーパー管理者",
        "customerSupport": "カスタマーサービスサポート",
        "localStorageMode": "ローカルストレージモード"
    },
    
    zh: {
        // Header
        "pageTitle": "任务历史",
        "searchPlaceholder": "搜索任务...",
        
        // Section Header
        "sectionTitle": "任务历史",
        "filterDate": "筛选日期",
        "filterCategory": "筛选类别",
        "allCategories": "所有类别",
        "clearFilter": "重置筛选",
        
        // Categories
        "sharePromotion": "分享促销面板",
        "checkDomain": "检查域名",
        "checkGame": "检查游戏",
        "checkPending": "检查待处理",
        "checkMaintenance": "检查维护",
        "other": "其他",
        
        // Task Status
        "completed": "已完成",
        "pending": "待处理",
        
        // Empty State
        "noHistory": "无任务历史",
        "noHistoryMessage": "没有已完成的任务或符合筛选条件的任务。",
        
        // Task Meta
        "minutes": "分钟",
        
        // User Roles
        "superAdmin": "超级管理员",
        "customerSupport": "客户服务支持",
        "localStorageMode": "本地存储模式"
    }
};

// ========== TRANSLATION FUNCTIONS ==========

// Fungsi untuk menerapkan terjemahan ke halaman task history
function applyTaskHistoryTranslations(language) {
    const lang = taskHistoryTranslations[language] || taskHistoryTranslations['id'];
    
    if (!lang) return;

    console.log("Applying task history translations for:", language);

    // Terjemahkan elemen utama
    const elements = {
        'pageTitle': '.header h1',
        'searchPlaceholder': '#searchTasks',
        'sectionTitle': '.section-title',
        'filterDate': 'label[for="filterDate"]',
        'filterCategory': 'label[for="filterCategory"]',
        'clearFilter': '#clearFilter',
        'noHistory': '.empty-state h3',
        'noHistoryMessage': '.empty-state p'
    };

    Object.keys(elements).forEach(key => {
        const element = document.querySelector(elements[key]);
        if (element && lang[key]) {
            if (key === 'searchPlaceholder') {
                element.placeholder = lang[key];
            } else if (key === 'clearFilter') {
                // Handle button with icon
                const icon = element.querySelector('i');
                if (icon) {
                    element.innerHTML = icon.outerHTML + ' ' + lang[key];
                } else {
                    element.textContent = lang[key];
                }
            } else {
                // Handle elements with icons
                const iconMatch = element.innerHTML.match(/(<i[^>]*><\/i>)/);
                if (iconMatch) {
                    element.innerHTML = iconMatch[0] + ' ' + lang[key];
                } else {
                    element.textContent = lang[key];
                }
            }
        }
    });

    // Update kategori di filter
    updateTaskHistoryFilterCategories(language);
    
    // Update status tugas
    updateTaskHistoryTaskStatus(language);
    
    // Update peran pengguna
    updateTaskHistoryUserRole(language);
    
    // Render ulang tugas untuk update terjemahan
    if (typeof renderTasks === 'function') {
        setTimeout(() => {
            renderTasks();
        }, 100);
    }
}

// Update terjemahan kategori di filter
function updateTaskHistoryFilterCategories(language) {
    const lang = taskHistoryTranslations[language] || taskHistoryTranslations['id'];
    
    const categorySelect = document.getElementById('filterCategory');
    if (categorySelect) {
        const options = categorySelect.querySelectorAll('option');
        if (options.length >= 7) {
            if (lang.allCategories) options[0].text = lang.allCategories;
            if (lang.sharePromotion) options[1].text = lang.sharePromotion;
            if (lang.checkDomain) options[2].text = lang.checkDomain;
            if (lang.checkGame) options[3].text = lang.checkGame;
            if (lang.checkPending) options[4].text = lang.checkPending;
            if (lang.checkMaintenance) options[5].text = lang.checkMaintenance;
            if (lang.other) options[6].text = lang.other;
        }
    }
}

// Update terjemahan status tugas
function updateTaskHistoryTaskStatus(language) {
    const lang = taskHistoryTranslations[language] || taskHistoryTranslations['id'];
    
    // Update status di tugas yang sudah dirender
    document.querySelectorAll('.task-status').forEach(statusElement => {
        const isCompleted = statusElement.classList.contains('status-completed');
        const icon = statusElement.querySelector('i');
        
        if (icon && lang.completed && lang.pending) {
            statusElement.innerHTML = icon.outerHTML + ' ' + (isCompleted ? lang.completed : lang.pending);
        }
    });
}

// Update terjemahan peran pengguna
function updateTaskHistoryUserRole(language) {
    const lang = taskHistoryTranslations[language] || taskHistoryTranslations['id'];
    
    // Update user role display
    const userRoleElement = document.querySelector('.user-info p');
    if (userRoleElement) {
        const currentText = userRoleElement.textContent;
        if (currentText.includes('Customer Service Support') && lang.customerSupport) {
            userRoleElement.textContent = lang.customerSupport;
        } else if (currentText.includes('Super Administrator') && lang.superAdmin) {
            userRoleElement.textContent = lang.superAdmin;
        } else if (currentText.includes('Local Storage Mode') && lang.localStorageMode) {
            userRoleElement.textContent = lang.localStorageMode;
        }
    }
}

// ========== DATE FORMATTING FOR DIFFERENT LANGUAGES ==========

// Fungsi untuk memformat tanggal berdasarkan bahasa
function formatTaskDate(dateString, language) {
    if (!dateString) return '';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return dateString;
    
    const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    };
    
    // Sesuaikan locale berdasarkan bahasa
    let locale = 'id-ID'; // default
    
    switch(language) {
        case 'en':
            locale = 'en-US';
            break;
        case 'ja':
            locale = 'ja-JP';
            break;
        case 'zh':
            locale = 'zh-CN';
            break;
        default:
            locale = 'id-ID';
    }
    
    return date.toLocaleDateString(locale, options);
}

// ========== TASK RENDERING WITH TRANSLATION SUPPORT ==========

// Override fungsi renderTasks untuk mendukung multi-bahasa
function createTranslatedRenderTasks(originalRenderFunction) {
    return function(tasksToRender = null) {
        const language = localStorage.getItem('language') || 'id';
        const lang = taskHistoryTranslations[language] || taskHistoryTranslations['id'];
        
        let tasks = tasksToRender;
        
        if (!tasks) {
            const filterDateValue = document.getElementById('filterDate').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
            
            tasks = tasksData.filter(task => {
                // Filter berdasarkan pencarian
                if (searchTerm && !(
                    task.title.toLowerCase().includes(searchTerm) ||
                    (task.description && task.description.toLowerCase().includes(searchTerm))
                )) {
                    return false;
                }
                
                // Filter berdasarkan tanggal jika dipilih
                if (filterDateValue && task.date !== filterDateValue) {
                    return false;
                }
                
                // Filter berdasarkan kategori jika dipilih
                if (categoryFilter && task.category !== categoryFilter) {
                    return false;
                }
                
                return true;
            });
        }
        
        // Urutkan berdasarkan tanggal (terbaru pertama)
        const sortedTasks = [...tasks].sort((a, b) => {
            return new Date(b.date) - new Date(a.date);
        });
        
        const emptyState = document.getElementById('emptyState');
        const taskList = document.getElementById('taskList');
        
        if (sortedTasks.length === 0) {
            emptyState.style.display = 'block';
            taskList.style.display = 'none';
            
            // Update teks empty state
            const emptyTitle = emptyState.querySelector('h3');
            const emptyMessage = emptyState.querySelector('p');
            
            if (emptyTitle && lang.noHistory) {
                emptyTitle.textContent = lang.noHistory;
            }
            if (emptyMessage && lang.noHistoryMessage) {
                emptyMessage.textContent = lang.noHistoryMessage;
            }
            
            return;
        }
        
        emptyState.style.display = 'none';
        taskList.style.display = 'flex';
        taskList.innerHTML = '';
        
        sortedTasks.forEach(task => {
            const taskItem = document.createElement('div');
            taskItem.className = `task-item ${task.completed ? 'completed' : ''} fade-in`;
            
            // Format tanggal berdasarkan bahasa
            const formattedDate = formatTaskDate(task.date, language);
            
            taskItem.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <span class="task-status ${task.completed ? 'status-completed' : 'status-pending'}">
                        <i class="fas ${task.completed ? 'fa-check-circle' : 'fa-clock'}"></i>
                        ${task.completed ? lang.completed : lang.pending}
                    </span>
                </div>
                <div class="task-meta">
                    <span class="task-category">
                        <i class="fas fa-folder"></i> ${task.category}
                    </span>
                    ${task.time ? `
                    <span class="task-time">
                        <i class="fas fa-clock"></i> ${task.time} ${lang.minutes || 'menit'}
                    </span>
                    ` : ''}
                    <span class="task-date">
                        <i class="fas fa-calendar"></i> ${formattedDate}
                    </span>
                </div>
                ${task.description ? `
                <div class="task-description">
                    ${task.description}
                </div>
                ` : ''}
            `;
            
            taskList.appendChild(taskItem);
        });
    };
}

// ========== LANGUAGE INITIALIZATION ==========

// Fungsi inisialisasi bahasa untuk task history
function initializeTaskHistoryLanguage() {
    const savedLanguage = localStorage.getItem('language') || 'id';
    console.log("Initializing task history with language:", savedLanguage);
    
    // Terapkan terjemahan
    applyTaskHistoryTranslations(savedLanguage);
    
    // Override fungsi renderTasks dengan versi yang mendukung terjemahan
    if (typeof renderTasks === 'function') {
        window.renderTasks = createTranslatedRenderTasks(renderTasks);
    }
    
    // Setup listener untuk perubahan bahasa
    window.addEventListener('languageChanged', function(event) {
        console.log("Language changed in task history to:", event.detail.language);
        applyTaskHistoryTranslations(event.detail.language);
        
        // Render ulang tugas untuk update terjemahan
        if (typeof renderTasks === 'function') {
            setTimeout(() => {
                renderTasks();
            }, 100);
        }
    });
}

// ========== INTEGRATION WITH EXISTING CODE ==========

// Fungsi untuk mengintegrasikan dengan kode yang sudah ada
function integrateTaskHistoryWithLanguageSupport() {
    // Simpan referensi ke fungsi asli
    const originalLoadTasksData = window.loadTasksData;
    const originalRenderTasks = window.renderTasks;
    const originalFilterTasks = window.filterTasks;
    const originalResetFilters = window.resetFilters;
    
    // Inisialisasi bahasa
    initializeTaskHistoryLanguage();
    
    // Override fungsi renderTasks dengan versi yang sudah di-translate
    if (typeof originalRenderTasks === 'function') {
        window.renderTasks = createTranslatedRenderTasks(originalRenderTasks);
    }
}

// Panggil inisialisasi saat DOM ready
document.addEventListener('DOMContentLoaded', function() {
    // Tunggu sebentar untuk memastikan semua element sudah terload
    setTimeout(() => {
        integrateTaskHistoryWithLanguageSupport();
    }, 100);
});

// Juga panggil saat halaman sepenuhnya loaded
window.addEventListener('load', function() {
    integrateTaskHistoryWithLanguageSupport();
});
</script>
</body>
</html>
